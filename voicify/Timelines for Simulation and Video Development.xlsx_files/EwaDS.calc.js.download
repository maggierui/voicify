(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[14],{1072:function(y,D,b){function a(z){var r=this;this.$=z;(this.Al=this.$.da.Aa(268))||c.ULS.shipAssertTag(537170070,0,!1,"CalcHelper constructor - IInstantaneousSupportInformationManager is not available");var G=m.EwaSettings.isChangeGateEnabled("OfficeVSO:5543503_loadCalcCurrentVersion")?v.a.current.eo(53):v.a.current.eo(56);this.logger=new u.a;this.documentLoc=excelOnlineCalc.location.documentLoc("",this.$.workbookContext.FullDocumentInfo.BreadcrumbDocName);
this.sba=new d(z,this.Al);excelOnlineCalc.config.initCalc(this.logger,this.Al?function(w){return r.Al.isFeatureEnabled(w)}:function(){return!1},G);this.qig=excelOnlineCalc.config.calcConfig(this.sba.localeInfo)}function d(z,r){z=b(1072).CalcHelper;r&&(r.He||c.ULS.shipAssertTag(537169942,0,!1,"LocaleHolder constructor - locale information is not available"));this.yng=z.mBe(r,z.aBe(r.Jia));this.zng=excelOnlineCalc.calc.localeInfoFromData(this.localeData)}b.r(D);y=b(0);var c=b(13),k=b(308),n;(function(z){z[z.paren=
0]="paren";z[z.lead=1]="lead";z[z.intern=2]="intern";z[z.trail=3]="trail";z[z.undefined=4]="undefined"})(n||(n={}));Object(y.b)("CurrencyFormatOption",n);var l;(function(z){z[z.none=-1]="none";z[z.mdy=0]="mdy";z[z.dmy=1]="dmy";z[z.ymd=2]="ymd";z[z.myd=3]="myd";z[z.dym=4]="dym";z[z.ydm=5]="ydm"})(l||(l={}));Object(y.b)("DateOrderOption",l);var f=b(9);d.prototype.formatNumber=function(z){return this.localeInfo.formatNumber(z)};tl.Object.defineProperties(d.prototype,{localeInfo:{configurable:!0,enumerable:!0,
get:function(){return this.zng}},localeData:{configurable:!0,enumerable:!0,get:function(){return this.yng}}});Object(y.a)(d,"LocaleHolder",null,[]);var u=b(1131),v=b(51),m=b(1),A=b(19),x=b(14),t=b(193);b.d(D,"CalcHelper",function(){return a});a.prototype.X6g=function(){if(m.EwaSettings.isChangeGateEnabled("OfficeVSO:4986015_LetAutocompleteTelemetry")){if(!this.$.xa)return c.ULS.shipAssertTag(537170069,0,!1,"CalcHelper.CurrentSheetIndex() - this.ewaControl.Sheets is null"),0;var z=this.$.xa.oa;return z?
z.index:(c.ULS.shipAssertTag(537170068,0,!1,"CalcHelper.CurrentSheetIndex() - sheet is null"),0)}return this.$.xa.oa.index};a.prototype.createParser=function(){var z={};z.config=this.config;return excelOnlineCalc.parse.createParser(z)};a.prototype.createNumberFormatter=function(){var z=this,r=m.EwaSettings.isChangeGateEnabled("OfficeVSO:5935278_numberFormatterGetTime")?function(G,w){return excelOnlineCalc.calc.getTime(z.config,G,w,"Estimation")}:function(){return excelOnlineCalc.util.failure(excelOnlineCalc.util.notImplemented(["getTime"]))};
r=excelOnlineCalc.numfmt.createFormatGlobals(this.config,r);return excelOnlineCalc.numfmt.createNumberFormatter(r)};a.prototype.i5g=function(z,r,G){r=excelOnlineCalc.location.gridCell(r,G);z=excelOnlineCalc.location.sheetIndex(this.documentLoc,z);return excelOnlineCalc.location.sheetGridCell(z,r)};a.prototype.Thh=function(z,r){var G=excelOnlineCalc.calc.getEvalResultKind(z);switch(G){case 4:return{returnValue:z?this.sba.localeInfo.trueName:this.sba.localeInfo.falseName,kind:G};case 1:return{returnValue:m.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?
this.Ayc(this.sba.formatNumber(z),r):this.sba.formatNumber(z),kind:G};case 2:return{returnValue:m.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?this.Ayc(z.toString(),r):z.toString(),kind:G};case 128:return{returnValue:"",kind:G};case 8:switch(z.type){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:return{returnValue:this.sba.localeInfo.errorNames[z.type],kind:G};default:return{returnValue:a.unknownError,kind:G}}case 32:return{returnValue:m.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?
this.Ayc(this.A5g(z,r),r):"##UNSUPPORTED: ARRAY",kind:G};default:return{returnValue:x.a.instance.ea(2146),kind:G}}};a.prototype.Ayc=function(z,r){return z.length<=r?z:z.substring(0,r-3)+"..."};a.prototype.A5g=function(z,r){for(var G=this.sba.localeInfo.leftBrace,w=0;w<z.rows;++w){for(var B=0;B<z.cols;++B)G+=z.opers[w][B],B<z.cols-1&&(G+=this.sba.localeInfo.columnSeparator);w<z.rows-1&&(G+=this.sba.localeInfo.rowSeparator)}return this.Ayc(G,r-1)+this.sba.localeInfo.rightBrace};a.mBe=function(z,r){r=
void 0===r?null:r;var G=a.J2b(),w=z.He.TrueValueString,B=z.He.FalseValueString,U=z.He.DecimalSeparator.toString(),N=z.He.ListSeparator.toString(),P=z.He.ColumnSeparator.toString(),ia=z.He.RowSeparator.toString(),W=z.He.ThousandsDataArray,R=z.He.ThousandSeparator.toString(),I=z.He.Lcid,Q=z.He.Country,O=z.He.DigitsNumber,ba=z.He.ExpSeparatedBySpace,ca=z.He.FractionSeparator.toString(),S=z.He.PercentSeparatedBySpace,Y=A.a.HQg(Enum.toString(n,z.He.CurrencyFormat)),na=z.He.CurrencySymbolLead,Z=z.He.CurrencySeparatedBySpace,
wa=z.He.CurrencySymbolString,ma=z.He.DigitsCurrency,pa=-1===z.He.DateOrder?"MDY":t.c(Enum.toString(l,z.He.DateOrder)),Ia=z.He.DateSeparator.toString(),Ma=z.He.DateAlternativeSeparator.toString(),ob=z.He.Year4Digits,Cb=z.He.Month2Digits,Xa=z.He.Day2Digits,Sb=z.He.LongDateFormat,Tb=z.He.TimeSeparator.toString(),da=null==z.He.TimeAltSeparator?null:z.He.TimeAltSeparator.toString(),ya=z.He.Hour2Digits,hb=z.He.Use24HourClock,Gb=z.He.AmPmSeparatedBySpace,Qb=[z.He.AmString,z.He.PmString],Fb=z.He.DayNameShortArray,
ta=z.He.DayNameLongArray,xa=z.He.MonthNameShortArray,sa=z.He.MonthNameLongArray,lb=z.He.PictureSpecialArray,Yb=k.a.map(("\x00"+z.He.PictureSingleString).split(""),function(Xc){return"\x00"===Xc?null:Xc}),Fa=z.He.PictureColorArray,Sa=z.He.PictureDbnumArray,Ra=z.He.RowLetter.toString(),Lb=z.He.ColumnLetter.toString(),Ja=z.He.LeftBrace.toString(),xb=z.He.RightBrace.toString(),Kb=z.He.LeftBracket.toString(),Eb=z.He.RightBracket.toString(),Hc=a.VRh(z.He);return excelOnlineCalc.calc.localeData(r,G,w,B,
Ra,Lb,Ja,xb,Kb,Eb,U,N,P,ia,W,R,I,Q,O,ba,ca,S,Y,na,Z,wa,ma,pa,Ia,Ma,ob,Cb,Xa,Sb,Tb,da,ya,hb,Gb,Qb,Fb,ta,xa,sa,lb,Yb,Fa,Sa,Hc,z.He.SysDateFormatString,z.He.SysTimeFormatString)};a.aBe=function(z){var r=[];if(!z)return r;z=yl(z);for(var G=z.next();!G.done;G=z.next()){G=G.value;var w=null;G.IsDynamicUdf||(w=excelOnlineCalc.calc.worksheetFunctionName(G.FunctionIndexInServer,G.NameUI));w&&Array.add(r,w)}return r};a.J2b=function(){for(var z=[],r=Object.keys(f.a.errorNames),G=0;G<r.length;G++){var w=excelOnlineCalc.calc.errorTypeName(G+
1,r[G]);w&&Array.add(z,w)}return z};a.VRh=function(z){var r=Array(6);r[1]="#"+z.AllStructRefString;r[3]="#"+z.HeadersStructRefString;r[2]="#"+z.DataStructRefString;r[4]="#"+z.TotalsStructRefString;r[5]="#"+z.ThisRowStructRefString;return r};tl.Object.defineProperties(a.prototype,{config:{configurable:!0,enumerable:!0,get:function(){return this.qig}}});a.unknownError="##ERR##";Object(y.a)(a,"CalcHelper",null,[])},1133:function(y,D,b){function a(){}b.d(D,"a",function(){return a});y=b(0);a.Qki="literal";
a.operator="operator";a.func="function";a.namedRange="namedRange";a.range="range";a.khf="letName";a.all="*";a.nRd="structRefRange";Object(y.a)(a,"TraverseFormulaInterestTypes",null,[])},1134:function(y,D,b){function a(){}b.d(D,"a",function(){return a});y=b(0);a.cell="cell";a.range="range";a.row="row";a.column="col";Object(y.a)(a,"TraverseFormulaRefTypes",null,[])},1396:function(y,D,b){function a(ka){var bb=Mb.call(this)||this;bb.$=ka;bb.dc();return bb}function d(ka){var bb=wb.call(this)||this;bb.$=
ka;bb.dc();return bb}function c(ka,bb){var Ga=this;this.colors="rgba(95, 140, 237, {0});rgba(235, 94, 96, {0});rgba(141, 97, 194, {0});rgba(45, 150, 57, {0});rgba(191, 76, 145, {0});rgba(227, 130, 34, {0});rgba(55, 127, 158, {0})".split(";");this.q4a=this.P3f=!1;this.OBb=function(){Ga.q4a=!1};this.Nc=ka;this.gridView=Cb.g(ka);this.calcManager=bb;this.pci=pa.EwaSettings.isChangeGateEnabled("OfficeVSO:5041666_ImplementLogRecorderOnEwaJS");this.gef=pa.EwaSettings.isChangeGateEnabled("OfficeVSO:5899330_SuspendResumeRichText");
this.z9e=pa.EwaSettings.la(721);this.gridView.Kc.hq(this.OBb)}function k(ka,bb,Ga,Ha){this.dBj=ka;this.U4f=bb;this.Tfc=void 0===Ha?!1:Ha;Ga?(this.G5a=Ga.IsRangeRef,this.Mva=Ga.IsAbsoluteFirstRow,this.Lva=Ga.IsAbsoluteFirstColumn,this.ZKa=Ga.IsAbsoluteSecondRow,this.YKa=Ga.IsAbsoluteSecondColumn):P.ULS.shipAssertTag(537169941,0,!1,"MarqueeMetadata.Ctor: parseResultItem is null")}function n(ka){var bb=ub.call(this)||this;bb.$=ka;bb.dc();return bb}function l(ka){var bb=this;this.rl=null;this.Zbg=!1;
this.NId=this.instantaneousSupportInformationManager=this.RDb=null;this.ypf={};this.Bpf={};this.w$d=null;this.Olc=function(Ga){P.ULS.sendTraceTag(537170005,0,50,"CalcManager.OnLocaleInformationAvailable() called");Ga.WGd(bb.Olc);Ga.Jia.length?bb.slc(Ga,Sys.EventArgs.Empty):(P.ULS.sendTraceTag(537170004,0,50,"CalcManager.OnLocaleInformationAvailable() - waiting for functions information"),Ga.Pke(bb.slc))};this.slc=function(Ga){P.ULS.sendTraceTag(537170003,0,50,"CalcManager.OnFunctionsInfoReady called");
Ga.KGd(bb.slc);bb.yFj(Ga)};this.onContentReady=function(){bb.rl&&(bb.instantaneousSupportInformationManager&&bb.instantaneousSupportInformationManager.fkd||Xc.Task.delay(0).CWCT(function(){bb.rl.Qdb(1)},null,0,Pc.a.current))};this.brf=function(Ga,Ha){bb.rl&&(bb.instantaneousSupportInformationManager&&bb.instantaneousSupportInformationManager.fkd||bb.rl.sCe(Ha.$c.block))};P.ULS.sendTraceTag(537170067,0,50,"Creating CalcManager");this.T9e=!1;this.vb=ka;this.ny=Cb.g(ka);this.QDc=null;this.gridView.Nq(this.onContentReady);
this.gridView.Ca.WSc(this.brf);this.$.da.Za(268,function(Ga){Ga.He?(P.ULS.sendTraceTag(537170066,0,50,"CalcManager.ctor: LocaleInformation already available..."),bb.Olc(Ga,Sys.EventArgs.Empty)):(P.ULS.sendTraceTag(537170065,0,50,"CalcManager.ctor: waiting for LocaleInformation..."),Ga.ile(bb.Olc))})}function f(){}function u(){}function v(){this.YKa=this.ZKa=this.Lva=this.Mva=this.G5a=!1}function m(ka){var bb=this;this.wEd=null;this.Frd=this.vEd=this.QCb=!1;this.xCd=0;this.pCd=this.rCd=this.sCd=this.qCd=
-1;this.trueName="TRUE";this.falseName="FALSE";this.instantaneousSupportInformationManager=this.Nm=this.errorTypeNames=null;this.Kp=this.currentStateId=-1;this.Hsa="";this.q$=null;this.Pwf=function(){bb.setNumberFormats()};this.od=function(){P.ULS.sendTraceTag(537170081,0,50,"CalcAsyncEngine.OnWorkbookOpened() called");bb.Xe=new Sb.a;bb.Kp=-1;bb.currentStateId=-1;bb.Hsa="";bb.uqb=null;bb.vEd=!1;bb.Nm&&bb.clearCache()};this.l1f=(this.Nc=ka)?ka.ya.CalcWebWorkerSmokeTestPingIntervalMS:this.l1f;this.Xe=
new Sb.a;this.uqb=null;this.documentLoc=excelOnlineCalc.location.documentLoc("",this.Nc.workbookContext.FullDocumentInfo.BreadcrumbDocName);this.Nna()}function A(ka){this.L0d=null;this.init(ka)}function x(){}function t(ka){this.Yma=ka;this.w5=new Qb.a(Fb.a.Ik());this.Zjc=!1}function z(){this.nj=[];this.b9f=[];this.jZa={}}function r(ka,bb,Ga,Ha,Ua){this.type=ka;this.fullName=bb;this.range=Ga;this.sheetId=Ha;this.attributes=Ua;this.rG=null}function G(ka,bb){this.Vse=ka;this.sheetName=bb;this.utc=!1}
function w(ka){var bb=da.call(this)||this;bb.$=ka;bb.dc();return bb}function B(ka,bb){var Ga=Tb.call(this)||this;Ga.zqd=Q.a.Se;Ga.AXc=null;Ga.thc=!1;Ga.xeb=!1;Ga.jqf=function(){var Ha=Cb.g(Ga.$);Ha&&(Ha=Ha.sc(null))&&Ga.Cdb(Ha.cell.Gm,!0)};Ga.sDi=function(Ha){Ga.isActive()&&(ma.a.Pq(Ha.Errors)||!Ha.Result?P.ULS.sendTraceTag(537155726,0,50,"GetCategoryFromServer failed, ignoring - server errors: {0}",Ha.Errors?Ha.Errors.join(","):"None"):(Ha=Ha.Result,P.ULS.sendTraceTag(537155725,0,50,"Updating number format category cache, format index = {0}, category = {1}",
Ha.Index,Ha.Category),Ga.Sjj(Ha.Index,Ha.Category),Ga.raiseEvent(B.CYc,new ba.a(Ha.Index,Ha.Category),Ga)))};Ga.refresh=function(){P.ULS.sendTraceTag(537155722,0,50,"InstantaneousSupportInformationManager.Refresh: start refresh");Ga.V_b();if(Ga.isActive()&&Ga.fa.lc.allowEdits){if(Ga.xeb||Ga.hn&&!(Ga.fa.Fhc>Ga.zqd))Ga.TAc();else{P.ULS.sendTraceTag(537155721,0,50,"InstantaneousSupportInformationManager.Refresh: getting instantaneous support information.");var Ha=Ga.$.qa.ta;var Ua=Ga.hn?Ga.hn.Digest:
"",kb=Ga.XDi,$a=Ga.WDi,Xb=Ha.Oa(1,null);Xb.previousResponseDigest=Ua;Ha=S.i(Ha,"GetInstantaneousSupportInformation",Xb,kb,$a,null,null,132);Ga.kdd=Ha}P.ULS.sendTraceTag(537155720,0,50,"InstantaneousSupportInformationManager.Refresh: getting functions info.");Ga.SWe()}};Ga.vuf=function(Ha){P.ULS.sendTraceTag(537155716,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListFailed failed, status = {0}, HTTP status = {1}.",Ha.data.status,Ha.data.httpStatus);Ga.EJa=null};Ga.gN=function(){Ga.xeb=
!1;Ga.fa.TC(Ga.gN);Ga.jQa(Ga.thc?B.SNd:B.Nvd)};Ga.Zc=function(Ha,Ua){P.ULS.sendTraceTag(537155715,0,50,"InstantaneousSupportInformationManager.OnSessionIdChanged called");ca.a(Ua)&&Ga.jQa(B.SNd)};Ga.Kf=function(){P.ULS.sendTraceTag(537155714,0,50,"InstantaneousSupportInformationManager.OnWorkbookMetadataChanged called");3!==Ga.$.workbookContext.CalcMode&&Ga.Zvd(!Ga.$.workbookContext.CalcMode)};Ga.od=function(){P.ULS.sendTraceTag(537155713,0,50,"InstantaneousSupportInformationManager.OnWorkbookOpened called");
Ga.jQa(B.SNd);pa.EwaSettings.la(305)&&3!==Ga.$.workbookContext.CalcMode&&Ga.Zvd(!Ga.$.workbookContext.CalcMode)};Ga.RDi=function(Ha,Ua,kb){P.ULS.sendTraceTag(537155712,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess called.");Ga.EJa=null;Ga.isActive()?Ha.StateId===Q.a.Se?(P.ULS.sendTraceTag(537155682,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess: no session, waiting for session."),Ga.TAc()):!Ha.Result||Ga.yX&&Ga.yX.length?Ga.jQa(B.Nvd):Ga.byf(Ha,Ua,kb):
P.ULS.sendTraceTag(537155683,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess: manager is inactive, skipping.")};Ga.byf=function(Ha){Ga.yX=Ha.Result;P.ULS.sendTraceTag(537155681,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess refreshing functions info list, returned {0} functions.",Ga.yX?Ga.yX.length:-1);Ha=!1;if(Ga.yX){for(var Ua=yl(Ga.yX),kb=Ua.next();!kb.done;kb=Ua.next())if(kb=kb.value)Ga.ySe[kb.NameUI.toLocaleUpperCase()]=kb.FunctionIndex.toString(),
kb.NameUI!==kb.NameDataStrings&&(Ga.ySe[kb.NameDataStrings.toLocaleUpperCase()]=kb.FunctionIndex.toString(),Ha=!0),Ga.qzh.ia(kb.FunctionIndex,kb.NameUI);Ga.raiseEvent(B.uad,Sys.EventArgs.Empty,Ga)}Ha&&P.ULS.sendTraceTag(537155680,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess NameDataStrings functions names were used.")};Ga.XDi=function(Ha){if(Ga.isActive())if(P.ULS.shipAssertTag(537155679,0,!!Ga.$,"null ewaControl"),Ga.thc=!1,Ga.zqd=Ha.StateId,Ga.zqd===Q.a.Se)Ga.thc=!0,Ga.TAc();
else{if(Ha.Result){var Ua=Ga.hn;Ga.hn=Ha.Result;P.ULS.sendTraceTag(537155678,0,50,"InstantaneousSupportInformation updated, new result digest: {0}.",Ga.hn.Digest);Ha=[];if(Ua)Ha=B.yMh(Ua.NumberFormats,Ga.hn.NumberFormats);else for(Ua=0;Ua<Ga.hn.NumberFormats.length;Ua++)Ga.xkc.ia(Ua,Ga.hn.NumberFormats[Ua].NumberFormatCategory);Ua=yl(Ha);for(var kb=Ua.next();!kb.done;kb=Ua.next())kb=kb.value,Ga.xkc.ia(kb,Ga.hn.NumberFormats[kb].NumberFormatCategory);Ga.raiseEvent(B.swd,new N(Ha),Ga);pa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.StructuredReferencesInRangePicker",
!1)&&Ga.raiseEvent(B.hif)}Ga.jQa(B.Nvd)}};Ga.WDi=function(Ha){Ga.isActive()&&(10===Ha.data.status?P.ULS.sendTraceTag(537155677,0,50,"Instantaneous support information request cancelled."):(P.ULS.sendTraceTag(21311555,0,10,"Failed to update instantaneous support information, status = {0}, HTTP status = {1}.",Ha.data.status,Ha.data.httpStatus),Ga.thc=!0,Ga.TAc()))};P.ULS.sendTraceTag(537155737,0,50,"InstantaneousSupportInformationManager ctor start");Ga.fa=ka;Ga.$=bb;Ga.yFb=null;Ga.kdd=null;Ga.EJa=
null;Ga.hn=null;Ga.xkc=new Sb.a;Ga.ztb=new Sb.a;Ga.yX=[];Ga.qzh=new Sb.a;Ga.ySe={};Ga.fa.Sj(Ga.Zc);Ga.$.Rk(Ga.od);Cb.g(Ga.$).ha.bra(Ga.jqf);pa.EwaSettings.la(305)&&Ga.fa.jt(Ga.Kf);Ga.jQa(B.X6e);P.ULS.sendTraceTag(537155736,0,50,"InstantaneousSupportInformationManager ctor end");return Ga}function U(ka){this.data=ka}function N(ka){var bb=Y.call(this)||this;bb.rSj=ka;return bb}b.r(D);y=b(10);D=b(0);var P=b(13),ia=b(216),W=b(88),R=b(5),I=b(185),Q=b(9),O=b(36),ba=b(1021),ca=b(219),S=b(81),Y=Sys.EventArgs;
vm(N,Y);Object(D.a)(N,"NumberFormatsUpdatedEventArgs",Sys.EventArgs,[]);var na=b(44),Z=b(42),wa=b(32),ma=b(27),pa=b(1),Ia=b(659),Ma=b(19),ob=b(273),Cb=b(20),Xa=b(194);Object(D.a)(U,"NumberFormatDataHolder",null,[]);var Sb=b(122),Tb=O.a;vm(B,Tb);B.prototype.ile=function(ka){this.addHandler(B.swd,ka)};B.prototype.WGd=function(ka){this.removeHandler(B.swd,ka)};B.prototype.yzg=function(ka){this.addHandler(B.CYc,ka)};B.prototype.S3i=function(ka){this.removeHandler(B.CYc,ka)};B.prototype.Pke=function(ka){this.addHandler(B.uad,
ka)};B.prototype.KGd=function(ka){this.removeHandler(B.uad,ka)};B.prototype.cBg=function(ka){this.addHandler(B.hif,ka)};B.prototype.Cdb=function(ka,bb){var Ga=this.xkc.Ec(ka,0);var Ha=Ga.value;Ga=Ga.returnValue;!Ga&&0<ka&&this.$&&(P.ULS.sendTraceTag(537155735,0,50,"InstantaneousSupportInformationManager.TryGetNumberFormatCategory: failed to get category from numberFormatIndexToCategoryCache {0}",ka),this.zEh(ka),bb&&(Ha=this.yEh(ka),Ga=!0),Ia.a(ka,this.$.pI)&&(Ha=6));return{returnValue:Ga,category:Ha}};
B.prototype.Uai=function(ka){var bb=this.Cdb(ka,!0);var Ga=bb.category;if(bb.returnValue)return 6===Ga;P.ULS.sendTraceTag(537155733,0,50,"InstantaneousSupportInformationManager.IsFormatInPercentageCategory: failed to get category from format index {0}",ka);return!1};B.prototype.Pxh=function(ka){P.ULS.sendTraceTag(537155730,0,50,"InstantaneousSupportInformationManager.ForceRefreshFunctionInfo: Forcing refresh of functions");this.EJa=S.w(this.$.qa.ta,{FilterType:0},ob.b(this.byf,ka),this.vuf,null,null,
null)};B.prototype.VRe=function(){this.jQa(B.X6e)};B.prototype.Zvd=function(ka){this.AXc=ka};B.prototype.zEh=function(ka){if(this.ztb&&this.$){var bb=this.ztb.Ec(ka);var Ga=bb.value;if(!bb.returnValue||Ga.isCompleted){P.ULS.sendTraceTag(537155728,0,50,"Getting number format category for format index: {0}",ka);Ga=this.$.qa.ta;bb=this.sDi;var Ha=Ga.Oa(1,null);Ha.ifmt=ka;(Ga=S.i(Ga,"GetNumberFormatCategory",Ha,bb,null,null,null,4))&&this.ztb.ia(ka,Ga)}}else P.ULS.sendTraceTag(537155729,0,15,"GetCategoryFromServerAsync called on disposed InstantaneousSupportInformationManager instance, skipping")};
B.prototype.yEh=function(ka){return 1<=ka&&8>=ka?1:9<=ka&&12>=ka?2:13===ka||14===ka?6:15===ka?8:17===ka|18===ka?7:19===ka?4:16===ka||20<=ka&&29>=ka||31===ka?11:30===ka?9:32<=ka&&35>=ka?3:0};B.prototype.isActive=function(){var ka=void 0===this.fa||null===this.fa,bb=!ka&&this.fa.oc;P.ULS.sendTraceTag(537155727,0,50,"InstantaneousSupportInformationManager.IsActive: instantaneous support information manager active:{0} - sessionStateManager IsNullOrUndefined: {1}",bb,ka);return bb};B.prototype.Sjj=function(ka,
bb){this.xkc.ia(ka,bb)};B.prototype.dispose=function(){W.a.Fa(this.yFb);this.yFb=null;this.V_b();for(var ka=yl(this.ztb),bb=ka.next();!bb.done;bb=ka.next())(bb=bb.value.value)&&!bb.isCompleted&&R.AFrameworkApplication.Hd.Zt(bb.kt);this.ztb=null;this.fa&&(this.fa.kk(this.Zc),this.xeb&&this.fa.TC(this.gN),this.xeb=!1,this.fa.mw(this.Kf));this.fa=null;this.$&&Cb.g(this.$)&&Cb.g(this.$).ha&&(Cb.g(this.$).ha.aza(this.jqf),this.$.ml(this.od));this.$=null;Tb.prototype.dispose.call(this)};B.prototype.isFeatureEnabled=
function(ka){try{switch(ka){case "LocaleLongDateFormat":return pa.EwaSettings.la(196);case "GetLocaleDayNames":return pa.EwaSettings.la(197);case "CalculateTextWidthIgnoreLetterSpacing":return pa.EwaSettings.la(286);case "OfficeVSO:3657744_CalcFixForDateFormat":return pa.EwaSettings.isChangeGateEnabled("OfficeVSO:3657744_CalcFixForDateFormat");case "OfficeVSO:3858161_ClientSideEstimationForDateWithTheYearZero":return pa.EwaSettings.isChangeGateEnabled("OfficeVSO:3858161_ClientSideEstimationForDateWithTheYearZero");
case "CalcAutocompleteExperiment":return pa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSAutocompleteExperimentIsEnabled",!1);case "CalcNewFunctions":return pa.EwaSettings.la(247);case "CalcContractChecks":return pa.EwaSettings.la(248);case "CalcSupportDynamicArrays":return pa.EwaSettings.la(249);case "CalcFormatCalculations":return pa.EwaSettings.la(250);case "CalcFormulaCacheAPIChanges":return pa.EwaSettings.la(251);case "CalcStrictFormulaChecking":return pa.EwaSettings.la(252);
case "CalcSupportRowReference":return pa.EwaSettings.la(263);case "CalcParserUsesPledges":return pa.EwaSettings.la(310);case "CalcWebWorker":return!0;case "CalcWebWorkerTest":return pa.EwaSettings.la(309);case "CalcLookupFunctions":return pa.EwaSettings.la(311);case "CalcLogStopWatch":return pa.EwaSettings.la(379);case "CalcPreventSpillingHack":return pa.EwaSettings.la(253);case "CalcDynamicArrayOperators":return pa.EwaSettings.la(102);case "CalcDotOperator":return pa.EwaSettings.la(611);case "CalcLetFunction":return pa.EwaSettings.la(732);
default:return ka.startsWith("OfficeVSO:")?pa.EwaSettings.isChangeGateEnabled(ka):!1}}catch(bb){return P.ULS.sendTraceTag(537155724,0,15,"InstantaneousSupportInformation.IsFeatureEnabled({0}): feature parsing failed, returning false. Exception: {1}.",ka,bb.toString()),!1}};B.prototype.jQa=function(ka){this.isActive()&&this.fa.lc.allowEdits?(W.a.Fa(this.yFb),this.yFb=null,this.yFb=na.a.instance.create(this.refresh,ka,Z.a.L6h)):P.ULS.sendTraceTag(537155723,0,50,"InstantaneousSupportInformationManager.ScheduleRefresh: won't schedule refresh. Edit permission: AllowEdits {0}, IsEditMode {1}",
void 0!==this.fa&&null!==this.fa&&void 0!==this.fa.lc&&null!==this.fa.lc?this.fa.lc.allowEdits:!1,void 0===this.fa||null===this.fa?!1:this.$.fa.isEditMode)};B.prototype.SWe=function(){P.ULS.sendTraceTag(537155719,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync called.");this.EJa?P.ULS.sendTraceTag(537155718,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync already running, skipping."):this.isActive()?this.yX&&this.yX.length||(this.EJa=S.w(this.$.qa.ta,{FilterType:0},
this.RDi,this.vuf,null,null,null)):P.ULS.sendTraceTag(537155717,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync session is not yet active, skipping.")};B.prototype.TAc=function(){this.xeb||(this.xeb=!0,this.fa.ED(this.gN))};B.prototype.V_b=function(){this.Zt(this.kdd);this.Zt(this.EJa);this.EJa=this.kdd=null};B.prototype.Zt=function(ka){ka&&!ka.isCompleted&&this.$.qa.ta.Bdb(ka.kt)};B.yMh=function(ka,bb){if(!ka||!ka.length)return[];if(!bb||!bb.length){bb=Array(ka.length);for(var Ga=
0;Ga<ka.length;++Ga)bb[Ga]=ka[Ga].IfmtIndex;return bb}var Ha=new Sb.a;ka=yl(ka);for(Ga=ka.next();!Ga.done;Ga=ka.next())Ga=Ga.value,Ha.ia(Ga.IfmtIndex,new U(Ga));ka=new I.a;Ga={};bb=yl(bb);for(var Ua=bb.next();!Ua.done;Ga={Veb:Ga.Veb,SNb:Ga.SNb},Ua=bb.next())Ga.Veb=Ua.value,Ga.SNb=void 0,function(kb){return function(){var $a=Ha.Ec(kb.Veb.IfmtIndex);kb.SNb=$a.value;return $a}}(Ga)().returnValue&&Ga.SNb.data.FormatString===Ga.Veb.FormatString||ka.add(Ga.Veb.IfmtIndex);return ka.toArray()};tl.Object.defineProperties(B.prototype,
{He:{configurable:!0,enumerable:!0,get:function(){return this.hn?this.hn.LocaleInformation:null}},Jba:{configurable:!0,enumerable:!0,get:function(){return this.hn?this.hn.NumberFormats:[]}},Jia:{configurable:!0,enumerable:!0,get:function(){this.yX&&this.yX.length||this.SWe();return this.yX}},H6h:{configurable:!0,enumerable:!0,get:function(){return this.hn&&void 0!==this.hn.InstantaneousCalcWebWorkerPrecisionSamplingRate&&null!==this.hn.InstantaneousCalcWebWorkerPrecisionSamplingRate?this.hn.InstantaneousCalcWebWorkerPrecisionSamplingRate:
B.F8g}},K6h:{configurable:!0,enumerable:!0,get:function(){return this.hn&&void 0!==this.hn.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate&&null!==this.hn.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate?this.hn.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate:B.J8g}},J6h:{configurable:!0,enumerable:!0,get:function(){return this.hn&&void 0!==this.hn.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate&&null!==this.hn.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate?this.hn.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate:
B.I8g}},I6h:{configurable:!0,enumerable:!0,get:function(){return this.hn&&void 0!==this.hn.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate&&null!==this.hn.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate?this.hn.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate:B.H8g}},H8e:{configurable:!0,enumerable:!0,get:function(){return this.hn?this.hn.InstantaneousCalcWebWorkerRenderingTimeLimitInMs:B.G8g}},fkd:{configurable:!0,enumerable:!0,get:function(){return null!==this.AXc?this.AXc:
this.hn?this.hn.InstantaneousCalcManualMode:!1}}});B.swd="isim0";B.CYc="isim1";B.uad="isim2";B.hif="isim3";B.X6e=100;B.SNd=1E3;B.Nvd=3E5;B.F8g=.001;B.J8g=.1;B.I8g=.2;B.H8g=.001;B.G8g=50;Object(D.a)(B,"InstantaneousSupportInformationManager",O.a,[312,3]);var da=ia.a;vm(w,da);w.prototype.create=function(){this.$&&(P.ULS.sendTraceTag(537155672,0,50,"InstantaneousSupportInformationManagerFactory.Create: Start loading script"),this.Fb(this.$.da.Aa(268)||new B(this.$.fa,this.$)))};w.ja=function(ka){if(!ka)throw Error.argumentNull("ewaControl");
ka.da.Ha(246,new w(ka))};Object(D.a)(w,"InstantaneousSupportInformationManagerFactory",ia.a,[]);var ya=b(80),hb=b(110),Gb=b(84);Object(D.a)(G,"CalcBlockInformation",null,[]);Object(D.a)(r,"CalcNamedObject",null,[]);Object(D.a)(z,"GridCache",null,[]);var Qb=b(805),Fb=b(574);Object(D.a)(t,"SheetInformation",null,[]);var ta=b(1072),xa;(function(ka){ka[ka.initialization=0]="initialization";ka[ka.contentReady=1]="contentReady";ka[ka.cellEdit=2]="cellEdit"})(xa||(xa={}));Object(D.b)("UpdateDataTrigger",
xa);var sa=b(59);x.local="Local";x.rBj="Thread";Object(D.a)(x,"RecalcServiceCreateMode",null,[]);var lb=b(43),Yb=b(41),Fa=b(153);A.prototype.init=function(ka){this.L0d=new Sb.a;if(void 0!==ka&&null!==ka&&void 0!==ka.HeadersList&&null!==ka.HeadersList&&0<ka.HeadersList.length){ka=yl(ka.HeadersList);for(var bb=ka.next();!bb.done;bb=ka.next())bb=bb.value,this.W9.ia(bb.Index,bb.Name)}};tl.Object.defineProperties(A.prototype,{W9:{configurable:!0,enumerable:!0,get:function(){return this.L0d}}});Object(D.a)(A,
"ColHeadersListData",null,[]);var Sa=b(95);b(193);var Ra=b(335);m.prototype.dispose=function(){this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.WGd(this.Pwf);this.Nc&&this.Nc.ml(this.od);this.close()};m.prototype.Qdb=function(ka){if(!this.Nm)return!1;if(!this.instantaneousSupportInformationManager&&(this.instantaneousSupportInformationManager=this.Nc.da.Aa(268),!this.instantaneousSupportInformationManager))return P.ULS.sendTraceTag(537170198,0,50,"CalcAsyncEngine.UpdateData Failed to get instantaneousSupportInformationManager"),
!1;2!==ka&&(this.currentStateId=this.Nc.fa.Fhc,this.currentStateId===Q.a.Se&&(this.currentStateId=this.Nc.fa.rf));if(1===ka&&this.currentStateId<this.Kp)return P.ULS.sendTraceTag(537170197,0,50,"CalcAsyncEngine::UpdateData() currentStateId:{0} < lastUpdatedStateId:{1} - ignoring update",this.currentStateId,this.Kp),!1;this.Rhj();ka&&this.vEd||(this.kmj(),this.njj(),this.Yjj(),this.setNumberFormats(),this.instantaneousSupportInformationManager.ile(this.Pwf),this.Nc.Rk(this.od),this.vEd=!0);this.RZi();
var bb=!1;ka||(bb=this.z4h());if(ka||bb)this.vlj()?(this.$lj(ka),this.Zlj(),this.Kp=this.currentStateId,this.mTg()):P.ULS.sendTraceTag(537170196,0,15,"CalcAsyncEngine::UpdateData() for StateId:{0} failed - no Sheets information",this.currentStateId);2!==ka&&this.resumeRecalc();return!0};m.prototype.evalFormula=function(ka){if(!this.Nm)return P.ULS.sendTraceTag(537170195,0,15,"CalcAsyncEngine.EvalFormula: recalc engine is null"),Promise.resolve({});ka=this.Nm.evalFormula(this.Nc.fa.rf,ka,sa.d(this.Nc.xa.oa));
this.resumeRecalc();return ka};m.prototype.evalFormulaRange=function(ka,bb,Ga){if(!this.Nm)return P.ULS.sendTraceTag(537170194,0,15,"CalcAsyncEngine.EvalFormulaRange: recalc engine is null"),Promise.reject(null);P.ULS.shipAssertTag(537170193,0,bb.isSingle,"CalcAsyncEngine.EvalFormulaRange: originCell Range must be a single cell.");Ga=lb.j(Ga);bb=lb.o(bb,this.Nc);bb=excelOnlineCalc.calc.cellLocation(bb.FirstRow,bb.FirstColumn);Ga=m.YT("EvalFormulaRange",sa.d(this.Nc.xa.oa),Ga.FirstRow,Ga.FirstColumn,
Ga.LastRow,Ga.LastColumn);P.ULS.sendTraceTag(537170190,0,50,"CalcAsyncEngine.EvalFormulaRange: calling calc.ts's EvalFormulaRange API for state ID {0}",this.Kp);ka=this.Nm.evalFormulaRange(this.Kp,ka,bb,Ga,null);ka.then(function(Ha){if(excelOnlineCalc.util.isSuccess(Ha)){var Ua=[];Ha=yl(Ha.value);for(var kb=Ha.next();!kb.done;kb=Ha.next())kb=kb.value,excelOnlineCalc.util.isSuccess(kb.value)||(kb=kb.value.reason.kind.toString(),Array.contains(Ua,kb)||Ua.push(kb));P.ULS.sendTraceTag(537170191,0,50,
"CalcAsyncEngine.EvalFormulaRange - Evaluation of range complete. FailureReasons: {0}",Ua.length?Sys.Serialization.JavaScriptSerializer.serialize(Ua):"None")}else P.ULS.sendTraceTag(537170192,0,15,"CalcAsyncEngine.EvalFormulaRange: Calc.EvalFormulaRange returned a failed object. failure reason: {0}",Ha.reason.kind)}).catch(function(Ha){P.ULS.sendTraceTag(537170189,0,10,"CalcAsyncEngine.EvalFormulaRange - promise rejected: {0}",Sys.Serialization.JavaScriptSerializer.serialize(Ha));return Promise.reject(Ha)});
this.resumeRecalc();return ka};m.prototype.bPg=function(ka,bb,Ga,Ha){Ha=void 0===Ha?null:Ha;if(this.Nm&&ka){var Ua=sa.d(this.Nc.xa.oa),kb=ka.cell.SJ-1,$a=ka.cell.RJ-1,Xb=kb,dc=$a,Za=null;Ha&&(Za=excelOnlineCalc.calc.cellLocation(kb,$a),kb=Ha.top-1,$a=Ha.left-1,Xb=Ha.bottom-1,dc=Ha.right-1);if(ka.cell.Eu)if(Ha=ka.cell.Eu.wWc,Ha===Q.a.Se)P.ULS.sendTraceTag(537170187,0,15,"CalcAsyncEngine::CalculateFormula() BlockRevision unknown for block:{0}",ka.cell.Eu.Xd);else if(Ha<this.Kp)P.ULS.sendTraceTag(537170185,
0,50,"CalcAsyncEngine::CalculateFormula() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < lastUpdatedStateId:{3}",kb,$a,Ha,this.Kp);else if(Ha<this.currentStateId)P.ULS.sendTraceTag(537170184,0,50,"CalcAsyncEngine::CalculateFormula() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < currentStateId:{3}",kb,$a,Ha,this.currentStateId);else if(this.QCb||(this.Nm.setOnRecalcResults(Ga),this.QCb=!0),this.O8f()&&!this.Qdb(2))P.ULS.sendTraceTag(537170183,0,15,"CalcAsyncEngine.CalculateFormula: UpdateData failed");
else{dc=m.YT("CalculateFormula.cell",Ua,kb,$a,Xb,dc);Ga=[];var Wa=Cb.g(this.Nc);Xb=Wa.Ph;Cb.g(this.Nc).$a.Zi&&(Xb=Wa.fg(1).Ph,Xb.Lma(1,1),Xb.Lma(3,1));Wa=null;Xb?Wa=m.YT("CalculateFormula.viewport",Ua,Xb.top-1,Xb.left-1,Xb.bottom-1,Xb.right-1):P.ULS.sendTraceTag(537170182,0,50,"CalcAsyncEngine::CalculateFormula() viewportRange is null, calc will use entire sheet...");bb=excelOnlineCalc.calc.inferredRangeFormulaEdit(dc,bb,Za,Wa);Array.add(Ga,bb);ka=Xb?String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",
Ua,kb,$a,Ma.a.HYb(ka.cell.text),Ha,Xb.top-1,Xb.left-1,Xb.bottom-1,Xb.right-1):String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",Ua,kb,$a,Ma.a.HYb(ka.cell.text),Ha,"","","","");P.ULS.sendTraceTag(537170181,0,50,ka);this.Nm.editRangeFormulas(Ha,Ga);this.resumeRecalc()}else P.ULS.sendTraceTag(537170186,0,15,"CalcAsyncEngine::CalculateFormula() GridBlockModelProxy is null cell:({0},{1})",ka.cell.SJ,ka.cell.RJ)}else P.ULS.sendTraceTag(537170188,
0,15,"CalcAsyncEngine::CalculateFormula() recalc engine is null:{0}, modifiedCell is null:{1}",!this.Nm,!ka)};m.prototype.$Og=function(ka,bb,Ga,Ha){Ha=void 0===Ha?null:Ha;var Ua=sa.d(this.Nc.xa.oa),kb=ka.cell.SJ-1,$a=ka.cell.RJ-1,Xb=kb,dc=$a,Za=null;Ha&&(Za=excelOnlineCalc.calc.cellLocation(kb,$a),kb=Ha.top-1,$a=Ha.left-1,Xb=Ha.bottom-1,dc=Ha.right-1);Ga=this.JWd(ka,Ga,"SetCell");0>Ga||(dc=m.YT("CalculateFormula.cell",Ua,kb,$a,Xb,dc),Xb=[],Ha=this.Ifd(Ua),bb=excelOnlineCalc.calc.inferredRangeFormulaEdit(dc,
bb,Za,Ha),Array.add(Xb,bb),ka=(bb=this.d1e())?String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",Ua,kb,$a,Ma.a.HYb(ka.cell.text),Ga,bb.top-1,bb.left-1,bb.bottom-1,bb.right-1):String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",Ua,kb,$a,Ma.a.HYb(ka.cell.text),Ga,"","","",""),P.ULS.sendTraceTag(537170180,0,50,ka),this.Nm.editRangeFormulas(Ga,
Xb),this.resumeRecalc())};m.prototype.Wrb=function(ka,bb,Ga,Ha){if(!this.Nm)return P.ULS.sendTraceTag(537170179,0,15,"CalcAsyncEngine::EvalFormulaRangeOnClone recalc engine is null"),Promise.reject("RecalcService is null");P.ULS.shipAssertTag(537170178,0,Ga.isSingle,"CalcAsyncEngine::EvalFormulaRangeOnClone originCell must be a single cell.");var Ua=sa.d(this.Nc.xa.oa),kb=this.Ifd(Ua),$a=null;if(ka){$a=[];ka=yl(ka);for(var Xb=ka.next();!Xb.done;Xb=ka.next())if(Xb=Xb.value,Xb.column!==Ga.left){var dc=
Xb.row-1;var Za=Xb.column-1;dc=m.YT("EvalFormulaRangeOnClone.cell",Ua,dc,Za,dc,Za);Za=Xb.text;Array.add($a,excelOnlineCalc.calc.rangeWrite(dc,excelOnlineCalc.calc.valueCellData(Za,Za,Xb.Gm,null)))}}Ga=excelOnlineCalc.calc.cellLocation(Ga.top-1,Ga.left-1);bb=m.YT("EvalFormulaRangeOnClone.outputColumnRange",Ua,bb.top-1,bb.left-1,bb.bottom-1,bb.right-1);Ha=[excelOnlineCalc.calc.cellFormulaRangeFormulaEdit(bb,Ha,Ga,kb)];$a=this.Nm.evalOnClonedModel($a,Ha);this.resumeRecalc();return $a};m.prototype.sCe=
function(ka){var bb=null;try{if(ka)if(this.Hsa=Cb.g(this.Nc).Ca.rua(ka),this.currentStateId=ka.TRa,this.currentStateId<this.Kp||this.currentStateId===Q.a.Se)P.ULS.sendTraceTag(537170176,0,50,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() hash:{0} blockRevision:{1} < lastUpdatedStateId:{2}",this.Hsa,this.currentStateId,this.Kp);else{if(this.E4h(),!this.dKg()){var Ga=String.format("CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() Block Hash:{0} StateId:{1}",this.Hsa,this.currentStateId);
bb=this.Nc.Ub.Fc("ModelUpdate",Ga);this.uqb=this.Lub(ka.oa.sheetName);if(!this.uqb){var Ha=!!(this.Nc.Fd&32);P.ULS.sendTraceTag(537170147,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel SheetName not found. Number of existing sheets {0}, scratchPad:{1}, sheetNameLength:{2} Hash:{3}",this.Xe.wb(this.currentStateId)&&this.Xe.na(this.currentStateId).nj?this.Xe.na(this.currentStateId).nj.length:0,Ha,ka.oa.sheetName?ka.oa.sheetName.length:-1,ka.oa.hash)}else if(Cb.g(this.Nc).Ca.Hl.u0a(ka.Xd)){var Ua=
ka.yf;if(Ua){var kb=Ua.getCalcBlockModel();if(!kb)P.ULS.sendTraceTag(537170145,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel no model for block");else if(this.WJg(kb)){this.Xe.na(this.currentStateId).jZa[this.Hsa]=new G(kb,ka.oa.sheetName);var $a=ka.qe;$a?this.kxg($a.NamedObjects):P.ULS.sendTraceTag(537170144,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel GetGridBlockContentResponse is null")}}else P.ULS.sendTraceTag(537170146,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel no model accessor for block:{0}",
this.Hsa)}}}else P.ULS.shipAssertTag(537170177,0,!1,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() blockCacheItem is null")}finally{bb&&bb.stop()}};m.prototype.Rub=function(ka){if(!this.Xe.na(this.currentStateId).nj||!this.Xe.na(this.currentStateId).nj[0])return null;var bb=this.Xe.na(this.currentStateId).nj[0].w5;if(!bb||!bb.wb(ka.name))return null;bb=bb.na(ka.name);if(!bb||!bb.rG)return null;ka=new I.a;bb=yl(bb.rG.W9);for(var Ga=bb.next();!Ga.done;Ga=bb.next())ka.add(Ga.value.value);return ka};
m.prototype.getNameLoc=function(ka,bb){return this.vfc()?this.Xe.na(this.currentStateId).nj[0].w5.wb(bb)?(ka=excelOnlineCalc.location.nameLoc(ka,bb),excelOnlineCalc.util.success(ka)):excelOnlineCalc.util.success(null):(ka=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(ka))};m.prototype.getContainingTable=function(ka){if(!this.vfc())return ka=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(ka);var bb=ka.range.col,Ga=ka.range.row,Ha=this.Xe.na(this.currentStateId).nj[0].w5,
Ua=null;Ha=yl(Ha);for(var kb=Ha.next();!kb.done;kb=Ha.next())if(kb=kb.value.value,2===kb.type&&Ma.a.equals(ka.sheet.index.toString(),kb.sheetId,!0)){var $a=kb.range;bb>=$a.left-1&&bb<=$a.right-1&&Ga<=$a.bottom-1&&Ga>=$a.top-1&&(Ua=excelOnlineCalc.location.nameScope(this.documentLoc,kb.sheetId),Ua=excelOnlineCalc.location.nameLoc(Ua,kb.fullName))}return Ua?excelOnlineCalc.util.success(Ua):excelOnlineCalc.util.success(null)};m.prototype.getStructRefColumn=function(ka,bb){if(!this.vfc()){var Ga=excelOnlineCalc.util.unavailable([2]);
return excelOnlineCalc.util.failure(Ga)}Ga=ka.name;var Ha=this.Xe.na(this.currentStateId).nj[0].w5;if(Ha.wb(Ga)){Ha=Ha.na(Ga);var Ua=Ha.range;if(2!==Ha.type)return excelOnlineCalc.util.failure(this.l2c(5));var kb=Ha.rG?Ha.rG.W9:null;if(!kb)return excelOnlineCalc.util.success(null);for(var $a=yl(kb),Xb=$a.next();!Xb.done;Xb=$a.next())if(Xb=Xb.value,Ma.a.equals(Xb.value,bb,!0))return ka=excelOnlineCalc.location.documentLoc(ka.scope.document.path,ka.scope.document.name),ka=excelOnlineCalc.location.sheetIndex(ka,
Ha.sheetId),Ua=excelOnlineCalc.location.gridRange(Ua.top-1,Xb.key,Ua.bottom-Ua.top+1,1),Ua=excelOnlineCalc.location.sheetGridRange(ka,Ua),Ga=excelOnlineCalc.location.structRefColumnLoc(Ga,Ua,!!(Ha.attributes&16),!!(Ha.attributes&8)),excelOnlineCalc.util.success(Ga);return Ua.right-Ua.left+1!==kb.count?(Ga=excelOnlineCalc.util.unavailable([17,ka,bb]),excelOnlineCalc.util.failure(Ga)):excelOnlineCalc.util.failure(this.l2c(0))}return excelOnlineCalc.util.success(null)};m.prototype.getStructRefSpecialRef=
function(ka,bb){if(!this.vfc())return bb=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(bb);var Ga=this.Xe.na(this.currentStateId).nj[0].w5;if(Ga.wb(ka.name)){var Ha=Ga.na(ka.name);if(2!==Ha.type)return excelOnlineCalc.util.failure(this.l2c(5));Ga=!!(Ha.attributes&16);var Ua=!!(Ha.attributes&8),kb=Ga?1:0,$a=Ua?1:0;ka=excelOnlineCalc.location.documentLoc(ka.scope.document.path,ka.scope.document.name);ka=excelOnlineCalc.location.sheetIndex(ka,Ha.sheetId);Ha=Ha.range;var Xb={};if(1===
bb)Xb=excelOnlineCalc.location.gridRange(Ha.top-kb-1,Ha.left-1,Ha.bottom+$a-Ha.top+kb+1,Ha.right-Ha.left+1);else if(2===bb)Xb=excelOnlineCalc.location.gridRange(Ha.top-1,Ha.left-1,Ha.bottom-Ha.top+1,Ha.right-Ha.left+1);else if(3===bb)if(Ga)Xb=excelOnlineCalc.location.gridRange(Ha.top-2,Ha.left-1,1,Ha.right-Ha.left+1);else return excelOnlineCalc.util.success(null);else if(4===bb)if(Ua)Xb=excelOnlineCalc.location.gridRange(Ha.bottom,Ha.left-1,1,Ha.right-Ha.left+1);else return excelOnlineCalc.util.success(null);
bb=excelOnlineCalc.location.sheetGridRange(ka,Xb);return excelOnlineCalc.util.success(bb)}return excelOnlineCalc.util.success(null)};m.prototype.getDocumentLoc=function(ka,bb){if((Ma.a.equals(ka,this.documentLoc.path,!0)||!ka)&&Ma.a.equals(bb,this.documentLoc.name,!0))return excelOnlineCalc.util.success(this.documentLoc);ka=excelOnlineCalc.util.unavailable([0,excelOnlineCalc.location.documentLoc(ka,bb)]);return excelOnlineCalc.util.failure(ka)};m.prototype.getSheetIndex=function(ka,bb){if(!this.Xe.wb(this.currentStateId)||
!this.Xe.na(this.currentStateId).nj)return bb=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(bb);ka=this.Xe.na(this.currentStateId).nj;for(var Ga=1;Ga<ka.length;Ga++)if(Ma.a.equals(ka[Ga].Yma.sheetName,bb,!0))return excelOnlineCalc.util.success(ka[Ga].Yma.sheetId);return excelOnlineCalc.util.success(null)};m.prototype.getSheetName=function(ka,bb){if(!this.Xe.wb(this.currentStateId)||!this.Xe.na(this.currentStateId).nj)return bb=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(bb);
ka=this.Xe.na(this.currentStateId).nj;for(var Ga=1;Ga<ka.length;Ga++)if(Ma.a.equals(ka[Ga].Yma.sheetId,bb,!0))return excelOnlineCalc.util.success(ka[Ga].Yma.sheetName);return excelOnlineCalc.util.success(null)};m.prototype.getUserDefinedFuncLoc=function(){return excelOnlineCalc.util.notImplemented(["ParseGlobals.GetUserDefinedFuncLoc not implemented in main thread"])};m.prototype.getSheetRangeIndexes=function(){return excelOnlineCalc.util.notImplemented(["ParseGlobals.GetSheetRangeIndexes not implemented in main thread"])};
m.prototype.aPg=function(ka,bb,Ga){var Ha=Cb.g(this.Nc),Ua=Ha.sc(bb);Ua=this.JWd(Ua,null,"CopyPaste");Ga=this.JWd(Ha.sc(ka),Ga,"CopyPaste");if(0>Ua||0>Ga||Ua!==Ga)P.ULS.sendTraceTag(537170143,0,15,"CalcAsyncEngine::CalculateFormulaForCopyPaste(). Revision not valid. sourceRevision:{0}, targetRevision:{1}.",Ga,Ua);else{Ga=[];Ha=sa.d(this.Nc.xa.oa);var kb=this.Ifd(Ha);ka=m.YT("CalculateFormulaForCopyPaste.srcRange",Ha,ka.top-1,ka.left-1,ka.bottom-1,ka.right-1);bb=m.YT("CalculateFormulaForCopyPaste.targetRange",
Ha,bb.top-1,bb.left-1,bb.bottom-1,bb.right-1);bb=excelOnlineCalc.calc.copyPasteRangePasteEdit(bb,ka,kb);Array.add(Ga,bb);bb=kb?String.format("CalcAsyncEngine::CalculateFormulaForCopyPaste() for sheet:{0}, stateId:{1} viewport:(({2},{3})-({4},{5}))",Ha,Ua,kb.row,kb.column,kb.lastRow,kb.lastColumn):String.format("CalcAsyncEngine::CalculateFormulaForCopyPaste() for sheet:{0}, stateId:{1} viewport:(({2},{3})-({4},{5}))",Ha,Ua,"","","","");P.ULS.sendTraceTag(537170142,0,50,bb);this.Nm.editRangePaste(Ua,
Ga);this.resumeRecalc()}};m.prototype.Ifd=function(ka){var bb=this.d1e(),Ga=null;bb?Ga=m.YT("GetViewport.viewport",ka,bb.top-1,bb.left-1,bb.bottom-1,bb.right-1):P.ULS.sendTraceTag(537170141,0,50,"CalcAsyncEngine::GetViewport() viewportRange is null, calc will use entire sheet...");return Ga};m.prototype.d1e=function(){var ka=Cb.g(this.Nc),bb=ka.Ph;if(Cb.g(this.Nc).$a.Zi){bb=ka.fg(1).Ph;if(pa.EwaSettings.isChangeGateEnabled("OfficeVSO:5497152_JSCrash_At_CalcAsyncEngine_GetViewportRange")&&!bb)return P.ULS.sendTraceTag(537170140,
0,15,"CalcAsyncEngine::GetViewportRange viewportRange is null."),null;bb.Lma(1,1);bb.Lma(3,1)}return bb};m.prototype.JWd=function(ka,bb,Ga){if(!this.Nm||!ka)return P.ULS.sendTraceTag(537170139,0,15,"CalcAsyncEngine::ValidateCalculateFormulaInit() recalc engine is null:{0}, modifiedCell is null:{1}, operation:{2}",!this.Nm,!ka,Ga),-1;var Ha=ka.cell.SJ-1,Ua=ka.cell.RJ-1;if(ka.cell.Eu){var kb=ka.cell.Eu.wWc;if(kb===Q.a.Se)return P.ULS.sendTraceTag(537170138,0,15,"CalcAsyncEngine::ValidateCalculateFormulaInit() BlockRevision unknown for block:{0}, operation:{1}",
ka.cell.Eu.Xd,Ga),-1}else return P.ULS.sendTraceTag(537170137,0,15,"CalcAsyncEngine::ValidateCalculateFormulaInit() GridBlockModelProxy is null cell:({0},{1}), operation:{2}",ka.cell.SJ,ka.cell.RJ,Ga),-1;if(kb<this.Kp)return P.ULS.sendTraceTag(537170136,0,50,"CalcAsyncEngine::ValidateCalculateFormulaInit() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < lastUpdatedStateId:{3}, operation:{4}",Ha,Ua,kb,this.Kp,Ga),-1;if(kb<this.currentStateId)return P.ULS.sendTraceTag(537170135,0,50,"CalcAsyncEngine::ValidateCalculateFormulaInit() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < currentStateId:{3}, operation:{4}",
Ha,Ua,kb,this.currentStateId,Ga),-1;bb&&!this.QCb&&(this.Nm.setOnRecalcResults(bb),this.QCb=!0);return this.O8f()&&!this.Qdb(2)?(P.ULS.sendTraceTag(537170134,0,15,"CalcAsyncEngine.ValidateCalculateFormulaInit: UpdateData failed. operation:{0}",Ga),-1):kb};m.prototype.getFormulaBarText=function(ka,bb,Ga){return bb&&bb.startsWith("'")?bb:ka.cell.formulaBarText||Ga.toString()};m.prototype.r4g=function(ka,bb,Ga){var Ha=null;if(this.zte()&&this.Xe.na(this.Kp).jZa){var Ua=this.Xe.na(this.Kp).jZa[ka];if(null===
Ua||void 0===Ua?0:Ua.utc)Ha=Ua.Vse}Ga=this.g9h(Ha,bb,Ga);bb=this.LWg(Ha,bb,Ga);P.ULS.sendTraceTag(50671754,0,50,"CalcAsyncEngine::CreateRangeUpdateCommands() completed for Block Hash:{0} StateId:{1} number of formulas {2}",ka,this.currentStateId,bb)};m.prototype.g9h=function(ka,bb,Ga){var Ha=!1,Ua=m.vUe(bb);if(ka){var kb=m.vUe(ka);Ma.a.equals(kb,Ua,!1)&&(Ha=!0)}Ha?this.Mxg(ka,this.Kp,Ga):this.Oxg(bb,Ga);return Ha};m.prototype.zte=function(){var ka=!1;this.Nm&&-1!==this.Kp&&(ka=this.Nm.stateIdAvailable(this.Kp));
return ka&&this.Xe.wb(this.Kp)&&this.Kp<this.currentStateId};m.prototype.LWg=function(ka,bb,Ga){var Ha=0;var Ua,kb;for(bb.reset();Ua=bb.getNextCell();)Xa.e(Ua.formula)&&Ha++,(kb=Ga?ka.getCell(Ua.row,Ua.col):null)?this.HWg(bb,Ua,kb):this.Nxg(bb,Ua);if(Ga)for(ka.reset();kb=ka.getNextCell();)(Ua=bb.getCell(kb.row,kb.col))||this.Ije(ka,kb);return Ha};m.prototype.Yjj=function(){this.Nm.setOnUpdateRequest(function(){})};m.prototype.Xjj=function(){var ka=this;this.Nm.setOnUnresponsive(function(bb,Ga,Ha,
Ua){ka.bMi(bb,Ga,Ha,Ua)})};m.prototype.bMi=function(ka,bb,Ga,Ha){P.ULS.sendTraceTag(537170126,0,15,"CalcAsyncEngine.onUnresponsive: worker thread was unresponsive. timeout:{0}, waitTime:{1}, timeoutCount:{2}, hasBeenClosed:{3}.",ka,bb,Ga,Ha);Ha&&(this.$9i(),this.Nna())};m.prototype.$9i=function(){this.od(null,null);this.Frd=this.QCb=!1;this.xCd=0;this.pCd=this.rCd=this.sCd=this.qCd=-1};m.prototype.close=function(){this.Nm.close()};m.prototype.clearCache=function(){this.Nm.clearCache()};m.prototype.resumeRecalc=
function(){this.Nm.resumeRecalc()};m.prototype.njj=function(){this.Nm.setA1ReferenceStyle(!0)};m.prototype.RZi=function(){if(this.instantaneousSupportInformationManager){var ka=this.instantaneousSupportInformationManager.H6h,bb=this.instantaneousSupportInformationManager.K6h,Ga=this.instantaneousSupportInformationManager.J6h,Ha=this.instantaneousSupportInformationManager.I6h,Ua=!1;ka!==this.qCd&&(Ua=!0,this.qCd=ka);bb!==this.sCd&&(Ua=!0,this.sCd=bb);Ga!==this.rCd&&(Ua=!0,this.rCd=Ga);Ha!==this.pCd&&
(Ua=!0,this.pCd=Ha);var kb=[];pa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSExceLintExperimentIsEnabled",!1)&&(Ua=excelOnlineCalc.calc.runExperiment("ExceLintExperiment",null),kb.push(Ua),Ua=!0);pa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.UnitExperiment",!1)&&(Ua=excelOnlineCalc.calc.runExperiment("UnitExperiment",null),kb.push(Ua),Ua=!0);pa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSAutocompleteExperimentIsEnabled",!1)&&(Ua=excelOnlineCalc.calc.runExperiment("AutocompleteExperiment",
null),kb.push(Ua),Ua=!0);Ua&&(ka=excelOnlineCalc.calc.recalcServiceConfig(null,ka,null,bb,null,null,null,Ga,kb,Ha),this.Nm.reconfigure(ka))}};m.prototype.$lj=function(ka){var bb=this,Ga=null;if(this.Xe.wb(this.currentStateId))try{this.q$=[];var Ha=String.format("CalcAsyncEngine::SetUpdatedRanges() StateId:{0} UpdateTriggerData:{1}",this.currentStateId,xa[ka]);Ga=this.Nc.Ub.Fc("ModelUpdate",Ha);hb.a.forEach(this.Xe.na(this.currentStateId).jZa,function(Ua,kb){kb.utc||(bb.r4g(Ua,kb.Vse,kb.sheetName),
kb.utc=!0)},null);this.Nm.updateRanges(this.currentStateId,this.q$)}finally{Ga&&Ga.stop()}else P.ULS.sendTraceTag(537170122,0,15,"CalcAsyncEngine::SetUpdatedRanges StateId:{0} does not exist in GridCache",this.currentStateId)};m.prototype.Zlj=function(){var ka=[],bb=this.zte(),Ga=bb&&this.Xe.na(this.Kp).nj&&this.Xe.na(this.Kp).nj[0]&&this.Xe.na(this.Kp).nj[0].Zjc?this.Xe.na(this.Kp).nj[0].w5:null;this.mye(Ga,this.Xe.na(this.currentStateId).nj[0].w5,null,this.Kp,ka);this.Xe.na(this.currentStateId).nj[0].Zjc=
!0;for(var Ha=1;Ha<this.Xe.na(this.currentStateId).nj.length;Ha++)Ga=-1,bb&&this.Xe.na(this.Kp).nj&&(Ga=this.Ped(this.Xe.na(this.currentStateId).nj[Ha].Yma.sheetName,this.Kp)),Ga=-1!==Ga&&this.Xe.na(this.Kp).nj[Ga].Zjc?this.Xe.na(this.Kp).nj[Ga].w5:null,this.mye(Ga,this.Xe.na(this.currentStateId).nj[Ha].w5,this.Xe.na(this.currentStateId).nj[Ha].Yma.sheetId,this.Kp,ka),this.Xe.na(this.currentStateId).nj[Ha].Zjc=!0;this.Nm.updateNamedObjects(this.currentStateId,ka)};m.prototype.mye=function(ka,bb,Ga,
Ha,Ua){if(void 0!==Ga&&null!==Ga){var kb=excelOnlineCalc.calc.undefinedNamesWrite(Ga);Array.add(Ua,kb)}if(ka){var $a=!1,Xb=[];kb=[];if(bb)for(var dc=yl(bb),Za=dc.next();!Za.done;Za=dc.next()){Za=Za.value;var Wa=Za.value;if(ka.wb(Za.key)){var Ba=ka.na(Za.key);m.Evi(Ba,Wa)?$a=!0:(Ba=excelOnlineCalc.calc.namedObject(Za.key,null),Array.add(Xb,Ba),m.vSc(Za.key,Wa,kb))}else m.vSc(Za.key,Wa,kb)}ka=yl(ka);for(Za=ka.next();!Za.done;Za=ka.next())dc=Za.value,bb&&bb.wb(dc.key)||(dc=excelOnlineCalc.calc.namedObject(dc.key,
null),Array.add(Xb,dc));$a&&(bb=excelOnlineCalc.calc.namedObjectsPromote(Ga,Ha),Array.add(Ua,bb));0<Xb.length&&(bb=excelOnlineCalc.calc.namedObjectsWrite(Ga,Xb),Array.add(Ua,bb));0<kb.length&&(Ga=excelOnlineCalc.calc.namedObjectsWrite(Ga,kb),Array.add(Ua,Ga))}else if(bb){kb=[];bb=yl(bb);for(Ha=bb.next();!Ha.done;Ha=bb.next())Ha=Ha.value,m.vSc(Ha.key,Ha.value,kb);0<kb.length&&(Ga=excelOnlineCalc.calc.namedObjectsWrite(Ga,kb),Array.add(Ua,Ga))}};m.prototype.dKg=function(){return this.Xe.na(this.currentStateId).jZa[this.Hsa]?
(P.ULS.sendTraceTag(537170121,0,50,"CalcAsyncEngine::BlockPreviouslyHandled Block Hash:{0} StateId:{1} previously handled",this.Hsa,this.currentStateId),!0):!1};m.prototype.WJg=function(ka){return 1===ka.getColumnNumbers().length&&ka.getColumnNumbers()[0]===m.Jtd+1?!1:!0};m.prototype.z4h=function(){var ka=this,bb=!1;Cb.g(this.Nc).Ca.M$c(function(Ga){Ga.state&1&&ka.Nc.fa.rf===Ga.ie.Revision&&(ka.sCe(Ga),bb=!0)});return bb};m.prototype.xAe=function(ka,bb){var Ga=ka.getRowNumbers(),Ha=ka.getColumnNumbers();
ka=Ga[0]-1;Ga=Ga[Ga.length-1]-1;var Ua=Ha[0]-1;Ha=Ha[Ha.length-1]-1;(bb=this.Lub(bb))||P.ULS.sendTraceTag(537170120,0,15,"CalcAsyncEngine::CreateBlockRangeLocation SheetName not found. Number of existing sheets {0}",this.Xe.wb(this.currentStateId)&&this.Xe.na(this.currentStateId).nj?this.Xe.na(this.currentStateId).nj.length:0);return m.YT("CreateBlockRangeLocation",bb,ka,Ua,Ga,Ha)};m.prototype.Mxg=function(ka,bb,Ga){if(Ga=this.xAe(ka,Ga)){var Ha=m.K2b(ka.getRowNumbers());ka=m.K2b(ka.getColumnNumbers());
bb=excelOnlineCalc.calc.rangePromote(Ga,bb,Ha,ka);this.q$[this.q$.length]=bb}};m.prototype.Oxg=function(ka,bb){if(bb=this.xAe(ka,bb)){var Ga=m.K2b(ka.getRowNumbers());ka=m.K2b(ka.getColumnNumbers());ka=excelOnlineCalc.calc.rangeWrite(bb,null,Ga,ka);this.q$[this.q$.length]=ka}};m.prototype.HWg=function(ka,bb,Ga){var Ha=null,Ua=0,kb=0;switch(bb.valueType){case 2:Ha=this.Gfd(bb);var $a=this.Gfd(Ga);$a=Ma.a.equals($a,Ha,!1);break;case 1:null===bb.value&&null===Ga.value?$a=!0:(Ua=parseFloat(bb.value),
$a=parseFloat(Ga.value)===Ua);break;default:null===bb.value&&null===Ga.value?$a=!0:(kb=parseFloat(bb.value),$a=kb===parseFloat(Ga.value))}$a&&bb.valueType===Ga.valueType&&bb.ifmt===Ga.ifmt&&bb.formulaType===Ga.formulaType&&Ma.a.equals(Ga.formula,bb.formula,!1)||(void 0!==bb.formula&&null!==bb.formula||void 0!==bb.value&&null!==bb.value||void 0!==bb.text&&null!==bb.text?this.oXb(ka,bb,Ha,Ua,kb):this.Ije(ka,bb))};m.prototype.kxg=function(ka){if(this.Nc.xb&&this.Nc.xb.items)for(var bb=0;bb<this.Nc.xb.count;bb++){var Ga=
this.Nc.xb.items[bb];if(2===Ga.type||3===Ga.type){var Ha=0,Ua=Ga.name,kb=Ua.lastIndexOf("!");if(0<kb){Ha=Ua.substr(0,kb);"'"===Ha.charAt(0)&&(Ha=Ha.substr(1,Ha.length-2));Ha=this.Ped(Ha,this.currentStateId);if(-1===Ha){P.ULS.sendTraceTag(595096334,0,15,"CalcAsyncEngine::AddNamedObjectsInBlock SheetName not found. Number of existing sheets {0}",this.Xe.wb(this.currentStateId)&&this.Xe.na(this.currentStateId).nj?this.Xe.na(this.currentStateId).nj.length:0);continue}Ua=Ua.substr(kb+1)}Ha=this.Xe.na(this.currentStateId).nj[Ha].w5;
var $a=Ga.usedRange;2===Ga.type&&($a=Fa.a(Ga));if(Ha.wb(Ua)){if(kb=Ha.na(Ua),pa.EwaSettings.isChangeGateEnabled("OfficeVSO:5502630_AddNamedObjectsInBlock_updateRange")&&(kb.range=$a,kb.attributes=Ga.attributes),2===kb.type&&(Ua=m.yQe(Ga.name,ka)))if(!kb.rG)kb.rG=new A(Ua.ColHeadersList);else if(Ua.ColHeadersList)for(Ua=yl(Ua.ColHeadersList.HeadersList),Ga=Ua.next();!Ga.done;Ga=Ua.next())Ga=Ga.value,kb.rG.W9.ia(Ga.Index,Ga.Name)}else(kb=this.Lub(Ga.sheetName))?(kb=new r(Ga.type,Ga.name,$a,kb,Ga.attributes),
2===kb.type&&(Ga=m.yQe(Ga.name,ka))&&(kb.rG=new A(Ga.ColHeadersList)),Ha.ia(Ua,kb)):P.ULS.sendTraceTag(537170117,0,50,"CalcAsyncEngine::AddNamedObjectsInBlock SheetName not found. Number of existing sheets {0}",this.Xe.wb(this.currentStateId)&&this.Xe.na(this.currentStateId).nj?this.Xe.na(this.currentStateId).nj.length:0)}}};m.prototype.oXb=function(ka,bb,Ga,Ha,Ua){var kb=ka.getRowNumbers()[bb.row]-1;ka=ka.getColumnNumbers()[bb.col]-1;kb=m.YT("AddRangeUpdateCommand",this.uqb,kb,ka,kb,ka);ka=null;
var $a=bb.formula||bb.text,Xb=excelOnlineCalc.calc.blankValue,dc=null;void 0!==bb.text&&null!==bb.text||void 0!==bb.value&&null!==bb.value||(Ga="",dc="This cell contains blanks only",bb.formulaType||($a=""));switch(bb.valueType){case 2:null!==Ga&&(bb.formulaType||(ka=excelOnlineCalc.calc.valueCellData($a,Ga,bb.ifmt,dc)),1===bb.formulaType&&(ka=excelOnlineCalc.calc.cellFormulaCellData($a,Ga,bb.ifmt,dc)),2===bb.formulaType&&(ka=excelOnlineCalc.calc.valueCellData("",Xb,0,"This cell is a part of an array")));
break;case 1:isNaN(Ha)?P.ULS.sendTraceTag(537170116,0,50,"CalcAsyncEngine::AddRangeUpdateCommand Cell({0},{1}) invalid numeric value",bb.row,bb.col):(bb.formulaType||(ka=excelOnlineCalc.calc.valueCellData($a,Ha,bb.ifmt,null)),1===bb.formulaType&&(ka=excelOnlineCalc.calc.cellFormulaCellData($a,Ha,bb.ifmt,null)),2===bb.formulaType&&(ka=excelOnlineCalc.calc.valueCellData("",Xb,0,"This cell is a part of an array")));break;case 3:isNaN(Ua)?P.ULS.sendTraceTag(537170115,0,15,"CalcAsyncEngine::AddRangeUpdateCommand Cell({0},{1}) invalid boolean value",
bb.row,bb.col):(Ga=1===Ua?!0:!1,bb.formulaType||(ka=excelOnlineCalc.calc.valueCellData($a,Ga,bb.ifmt,null)),1===bb.formulaType&&(ka=excelOnlineCalc.calc.cellFormulaCellData($a,Ga,bb.ifmt,null)),2===bb.formulaType&&(ka=excelOnlineCalc.calc.valueCellData("",Xb,0,"This cell is a part of an array")));break;case 4:isNaN(Ua)?P.ULS.sendTraceTag(537170114,0,15,"CalcAsyncEngine::AddRangeUpdateCommand Cell({0},{1}) invalid error value",bb.row,bb.col):(Ga=excelOnlineCalc.calc.errorValue(Ua),bb.formulaType||
(ka=excelOnlineCalc.calc.valueCellData($a,Ga,bb.ifmt,null)),1===bb.formulaType&&(ka=excelOnlineCalc.calc.cellFormulaCellData($a,Ga,bb.ifmt,null)),2===bb.formulaType&&(ka=excelOnlineCalc.calc.valueCellData("",Xb,0,"This cell is a part of an array")));break;default:ka=excelOnlineCalc.calc.valueCellData("",Xb,bb.ifmt,null)}ka&&(bb=excelOnlineCalc.calc.rangeWrite(kb,ka,null,null),this.q$[this.q$.length]=bb)};m.prototype.Nxg=function(ka,bb){switch(bb.valueType){case 2:this.oXb(ka,bb,this.Gfd(bb),null,
0);break;case 1:this.oXb(ka,bb,null,parseFloat(bb.value),0);break;default:this.oXb(ka,bb,null,null,parseFloat(bb.value))}};m.prototype.Ije=function(ka,bb){var Ga=ka.getRowNumbers()[bb.row]-1;ka=ka.getColumnNumbers()[bb.col]-1;Ga=m.YT("AddRangeUpdateCommandEmptyCell",this.uqb,Ga,ka,Ga,ka);bb=excelOnlineCalc.calc.valueCellData("",excelOnlineCalc.calc.blankValue,bb.ifmt,null);bb=excelOnlineCalc.calc.rangeWrite(Ga,bb,null,null);this.q$[this.q$.length]=bb};m.prototype.Lub=function(ka){ka=this.Ped(ka,this.currentStateId);
return 0<ka?this.Xe.na(this.currentStateId).nj[ka].Yma.sheetId:null};m.prototype.Ped=function(ka,bb){if(!this.Xe.wb(bb))return P.ULS.sendTraceTag(537170113,0,15,"CalcAsyncEngine.GetSheetInternalIndex StateId:{0} does not exist in GridCache",bb),-1;if(!this.Xe.na(bb).nj)return P.ULS.sendTraceTag(537170112,0,15,"CalcAsyncEngine.GetSheetInternalIndex sheetsInformation == null for StateId:{0}",bb),-1;bb=this.Xe.na(bb).nj;for(var Ga=1;Ga<bb.length;Ga++)if(Ma.a.equals(bb[Ga].Yma.sheetName,ka,!1))return Ga;
return-1};m.prototype.vlj=function(){if(!this.Xe.wb(this.currentStateId)||!this.Xe.na(this.currentStateId).nj.length)return P.ULS.sendTraceTag(537170083,0,15,"CalcAsyncEngine::SetSheetNamesAndUsedRanges() No sheets information for StateId:{0} or StateId does not exist in GridCache",this.currentStateId),!1;for(var ka=[],bb=1;bb<this.Xe.na(this.currentStateId).nj.length;bb++){var Ga=this.Xe.na(this.currentStateId).nj[bb];Ga&&Array.add(ka,Ga.Yma)}this.Nm.updateSheetNames(this.currentStateId,ka);this.Nm.updateUnusedCells(this.currentStateId,
this.Xe.na(this.currentStateId).b9f);return!0};m.prototype.setNumberFormats=function(){if(this.instantaneousSupportInformationManager){for(var ka=[],bb=yl(this.instantaneousSupportInformationManager.Jba),Ga=bb.next();!Ga.done;Ga=bb.next())Ga=Ga.value,Ga=excelOnlineCalc.calc.numberFormat(Ga.IfmtIndex,Ga.FormatString,Ga.Builtin),Array.add(ka,Ga);this.Nm.setNumberFormats(ka,!0)}};m.prototype.Rhj=function(){if(this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.He){var ka=
this.C4h();if(!this.Frd||ka)this.J2b(),this.instantaneousSupportInformationManager.He.TrueValueString&&(this.trueName=this.instantaneousSupportInformationManager.He.TrueValueString),this.instantaneousSupportInformationManager.He.FalseValueString&&(this.falseName=this.instantaneousSupportInformationManager.He.FalseValueString),ka=ta.CalcHelper.mBe(this.instantaneousSupportInformationManager,ka),this.Nm.setLocale(ka),this.Frd=!0}};m.prototype.kmj=function(){var ka=null;if(void 0!==this.Nc.workbookContext.TimeZoneInformation&&
null!==this.Nc.workbookContext.TimeZoneInformation){ka=null;this.Nc.workbookContext.TimeZoneInformation.StandardDate.Month&&(ka=excelOnlineCalc.date.dateTime(this.Nc.workbookContext.TimeZoneInformation.StandardDate.Year,this.Nc.workbookContext.TimeZoneInformation.StandardDate.Month,this.Nc.workbookContext.TimeZoneInformation.StandardDate.Day,this.Nc.workbookContext.TimeZoneInformation.StandardDate.Hour,this.Nc.workbookContext.TimeZoneInformation.StandardDate.Minute,this.Nc.workbookContext.TimeZoneInformation.StandardDate.Second,
this.Nc.workbookContext.TimeZoneInformation.StandardDate.DayOfWeek+1,this.Nc.workbookContext.TimeZoneInformation.StandardDate.Milliseconds,3));var bb=null;this.Nc.workbookContext.TimeZoneInformation.DaylightDate.Month&&(bb=excelOnlineCalc.date.dateTime(this.Nc.workbookContext.TimeZoneInformation.DaylightDate.Year,this.Nc.workbookContext.TimeZoneInformation.DaylightDate.Month,this.Nc.workbookContext.TimeZoneInformation.DaylightDate.Day,this.Nc.workbookContext.TimeZoneInformation.DaylightDate.Hour,
this.Nc.workbookContext.TimeZoneInformation.DaylightDate.Minute,this.Nc.workbookContext.TimeZoneInformation.DaylightDate.Second,this.Nc.workbookContext.TimeZoneInformation.DaylightDate.DayOfWeek+1,this.Nc.workbookContext.TimeZoneInformation.DaylightDate.Milliseconds,3));ka=excelOnlineCalc.date.tzData(this.Nc.workbookContext.TimeZoneInformation.Bias,ka,this.Nc.workbookContext.TimeZoneInformation.StandardBias,bb,this.Nc.workbookContext.TimeZoneInformation.DaylightBias)}else P.ULS.sendTraceTag(537170082,
0,15,"CalcAsyncEngine.SetWorkbookProperties: TimeZoneInformation is null");ka=excelOnlineCalc.calc.workbookProps(this.Nc.workbookContext.F1904,this.Nc.workbookContext.FDateCompatibility,ka);this.Nm.setWorkbookProps(ka)};m.prototype.Nna=function(){var ka=this;pa.EwaSettings.la(309)&&Ra.c(excelOnlineCalc.worker.runSmokeTest(1/0,this.l1f,!0)).continueWith(function(Ga){Ga.mg?P.ULS.sendTraceTag(537170079,0,15,"CalcAsyncEngine.TryInitialize: calc smoke test failed: {0}",Ga.mg.toString()):P.ULS.sendTraceTag(537170080,
0,50,"CalcAsyncEngine.TryInitialize: calc smoke test ended - a new one should start")});var bb=pa.EwaSettings.la(684)?x.local:x.rBj;this.wEd=Ra.c(excelOnlineCalc.calc.createRecalcService(bb,Yb.a.bka()));this.wEd.continueWith(function(Ga){Ga.mg?P.ULS.sendTraceTag(537170075,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker failed: {0}",Ga.mg.toString()):(P.ULS.sendTraceTag(537170078,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker is working as expected"),ka.Nm=ka.wEd.result,ka.Nm?ka.Qdb(0)?
ka.Xjj():P.ULS.sendTraceTag(537170077,0,15,"CalcAsyncEngine.TryInitialize: UpdateData failed to initialize"):P.ULS.sendTraceTag(537170076,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker result is null"))})};m.prototype.C4h=function(){var ka=this.instantaneousSupportInformationManager.Jia;if(!ka||this.xCd===ka.length)return null;this.xCd=ka.length;return ta.CalcHelper.aBe(ka)};m.prototype.J2b=function(){this.errorTypeNames=ta.CalcHelper.J2b()};m.prototype.E4h=function(){if(!(this.Xe.wb(this.currentStateId)&&
0<this.Xe.na(this.currentStateId).nj.length)){this.Xe.ia(this.currentStateId,new z);this.Xe.na(this.currentStateId).nj[0]=new t(null);for(var ka=this.Nc.xa,bb=0;bb<ka.count;bb++){var Ga=Object(Gb.a)(Sa.a,ka.getItem(bb));if(Ga){void 0!==Ga.sheetId&&null!==Ga.sheetId&&void 0!==Ga.name&&null!==Ga.name&&Ga.sheetId.length&&Ga.sheetName.length||P.ULS.sendTraceTag(537170074,0,15,"CalcAsyncEngine::InitializeGridForStateId() invalid sheet - index:{0} Id:{1} Hash:{2} NameLength:{3}",bb,Ga.sheetId,Ga.hash,Ga.name?
Ga.name.length:-1);var Ha=excelOnlineCalc.calc.sheetName(Ga.sheetId,Ga.name);this.Xe.na(this.currentStateId).nj[bb+1]=new t(Ha);Ha=Ga.usedRange.QW();Ha=excelOnlineCalc.calc.rangeLocation(0,0,Ha.LastRow,Ha.LastColumn);Ga=excelOnlineCalc.calc.unusedCellsUpdate(Ga.sheetId,Ha);Array.add(this.Xe.na(this.currentStateId).b9f,Ga)}else P.ULS.sendTraceTag(537170073,0,15,"CalcAsyncEngine.InitializeGridForStateId(): not sheet item for StateId:{0} sheet-index:{1}",this.currentStateId,bb)}}};m.prototype.mTg=function(){for(var ka=
yl(this.Xe),bb=ka.next();!bb.done;bb=ka.next())bb=bb.value,bb.key<this.Kp&&this.Xe.remove(bb.key)};m.prototype.Gfd=function(ka){ka=ka.value||ka.text;if(void 0===ka||null===ka)ka="";return ka};m.prototype.O8f=function(){if(!this.Xe.wb(this.currentStateId))return!1;var ka=!1;hb.a.forEach(this.Xe.na(this.currentStateId).jZa,function(bb,Ga){Ga.utc||(ka=!0)},null);return ka};m.prototype.l2c=function(ka){var bb={};bb.reason=ka;bb.kind=1;return bb};m.prototype.vfc=function(){return this.Xe.wb(this.currentStateId)&&
this.Xe.na(this.currentStateId).nj&&this.Xe.na(this.currentStateId).nj[0]&&this.Xe.na(this.currentStateId).nj[0].w5?!0:!1};m.v0g=function(ka){var bb=[];if(null===ka||void 0===ka?0:ka.W9){ka=yl(ka.W9);for(var Ga=ka.next();!Ga.done;Ga=ka.next())Ga=Ga.value,Ga=excelOnlineCalc.calc.columnData(Ga.key,Ga.value),Array.add(bb,Ga)}return bb};m.Evi=function(ka,bb){if(ka.type!==bb.type||ka.attributes!==bb.attributes||!Ma.a.equals(ka.fullName,bb.fullName,!1)||!ka.range.equals(bb.range))return!1;if(!ka.rG&&!bb.rG)return!0;
if(!ka.rG||!bb.rG||ka.rG.W9.count!==bb.rG.W9.count)return!1;var Ga={};ka=yl(ka.rG.W9);for(var Ha=ka.next();!Ha.done;Ga={Xeb:Ga.Xeb,dfb:Ga.dfb},Ha=ka.next())if(Ga.Xeb=Ha.value,Ga.dfb=void 0,!(Ga.Xeb.value&&function(Ua){return function(){var kb=bb.rG.W9.Ec(Ua.Xeb.key);Ua.dfb=kb.value;return kb}}(Ga)().returnValue&&Ga.dfb&&Ma.a.equals(Ga.Xeb.value,Ga.dfb,!1)))return!1;return!0};m.vSc=function(ka,bb,Ga){var Ha=m.YT("NamedObject",bb.sheetId,bb.range.top-1,bb.range.left-1,bb.range.bottom-1,bb.range.right-
1);if(2===bb.type){var Ua=!!(bb.attributes&16),kb=!!(bb.attributes&8);bb=m.v0g(bb.rG);Ha=excelOnlineCalc.calc.namedTableData(Ha,Ua,kb,bb);ka=excelOnlineCalc.calc.namedObject(ka,Ha)}else Ha=excelOnlineCalc.calc.namedRangeData(Ha),ka=excelOnlineCalc.calc.namedObject(ka,Ha);Array.add(Ga,ka)};m.vUe=function(ka){var bb=Sys.Serialization.JavaScriptSerializer.serialize(ka.getRowNumbers());ka=Sys.Serialization.JavaScriptSerializer.serialize(ka.getColumnNumbers());return bb+ka};m.K2b=function(ka){var bb=null;
if(1<ka.length)for(var Ga=1;Ga<ka.length;Ga++)for(var Ha=0;ka[Ga-1]+1+Ha<ka[Ga];)bb=bb||[],Array.add(bb,ka[Ga-1]+Ha),Ha++;return bb};m.yQe=function(ka,bb){if(!bb)return null;for(var Ga=0,Ha=bb.length;Ga<Ha;++Ga)if(Ma.a.equals(ka,bb[Ga].Name,!1))return bb[Ga];return null};m.YT=function(ka,bb,Ga,Ha,Ua,kb){function $a(Xb,dc,Za,Wa){(0>Za||Za>=Wa)&&P.ULS.sendTraceTag(537170072,0,15,"CalcAsyncEngine::CreateSheetRangeLocation() callerId:{0} invalid {1}:{2}",Xb,dc,Za)}void 0!==bb&&null!==bb||P.ULS.sendTraceTag(537170071,
0,15,"CalcAsyncEngine::CreateSheetRangeLocation() callerId:{0} sheetId is null",ka);$a(ka,"top",Ga,m.Wlf);$a(ka,"left",Ha,m.Jtd);$a(ka,"bottom",Ua,m.Wlf);$a(ka,"right",kb,m.Jtd);return excelOnlineCalc.calc.sheetRangeLocation(bb,Ga,Ha,Ua,kb)};m.Wlf=1048576;m.Jtd=16384;Object(D.a)(m,"CalcAsyncEngine",null,[3]);Object(D.a)(v,"AbsoluteRelativeReferenceInfo",null,[]);var Lb=b(1132),Ja=b(24);u.pEf="#";Object(D.a)(u,"Operators",null,[]);var xb=b(1133);f.sheet="Sheet";f.sheetRange="SheetRange";f.document=
"Document";f.t1h="Ident";Object(D.a)(f,"TraverseFormulaQualifierTypes",null,[]);var Kb=b(1134),Eb=b(1022),Hc=b(923),Xc=b(55),Pc=b(60);l.prototype.dispose=function(){var ka=this;P.ULS.sendTraceTag(537170064,0,50,"CalcManager.Dispose called");this.$.da.Za(268,function(bb){bb.WGd(ka.Olc);bb.KGd(ka.slc)});this.gridView&&(this.gridView.Us(this.onContentReady),this.gridView.Ca&&this.gridView.Ca.WLf(this.brf),this.ny=null);this.Bpf=this.ypf=this.QDc=null};l.prototype.cPg=function(ka,bb,Ga,Ha){Ha=void 0===
Ha?null:Ha;this.rl&&(pa.EwaSettings.isChangeGateEnabled("OfficeVSO:5470583_Calculate_Formula_Refactoring")?this.rl.$Og(ka,bb,Ga,Ha):this.rl.bPg(ka,bb,Ga,Ha))};l.prototype.evalFormula=function(ka){return this.rl?this.rl.evalFormula(ka):Promise.reject("calc engine not initialized")};l.prototype.evalFormulaRange=function(ka,bb,Ga){return this.rl?this.rl.evalFormulaRange(ka,bb,Ga):Promise.reject("calc engine not initialized")};l.prototype.Wrb=function(ka,bb,Ga,Ha){return this.rl?this.rl.Wrb(ka,bb,Ga,
Ha):Promise.reject("CalcEngine is null")};l.prototype.Rub=function(ka){return this.rl?(P.ULS.shipAssertTag(537170059,0,2===ka.type,"CalcManager.GetTableHeaders() - ActiveItem is not a table"),this.rl.Rub(ka)):null};l.prototype.oEg=function(ka,bb){if(!bb||2!==ka.type)return!1;ka=Fa.a(ka);return ka.right-ka.left+1===bb.count};l.prototype.XOe=function(ka){if(!this.RDb)return this.Zbg||P.ULS.sendTraceTag(537170057,0,15,"CalcManager.ExtractReferenceWrappers - parser not initialized"),null;var bb=this.rsa(Ja.Range.ld(1,
1));bb=this.RDb.parseFormula(excelOnlineCalc.parse.parseLocals(1,bb.range),ka);if(!excelOnlineCalc.parse.parseResultHelper.isSuccess(bb))return P.ULS.sendTraceTag(537170056,0,10,"CalcManager.ExtractReferenceWrappers - ParseFormula failed"),null;try{if(pa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.StructuredReferencesHighlighting",!1)){var Ga=this.gridView.ha.va.activeCell,Ha=excelOnlineCalc.location.gridCell(Ga.top-1,Ga.left-1),Ua=excelOnlineCalc.location.documentLoc("",this.$.workbookContext.FullDocumentInfo.BreadcrumbDocName),
kb=excelOnlineCalc.location.sheetIndex(Ua,this.$.xa.oa.sheetId),$a=this.L4g(Ha,kb);this.NId||(this.NId=excelOnlineCalc.util.createResolver(this.K4g()));var Xb=excelOnlineCalc.parse.parseResultHelper.extractReferences(bb,this.Br.config.localeInfo,pa.EwaSettings.la(622),$a,this.NId)}else Xb=excelOnlineCalc.parse.parseResultHelper.extractReferences(bb,this.Br.config.localeInfo,pa.EwaSettings.la(622));pa.EwaSettings.la(102)&&this.PKj(Xb,ka);return Xb}catch(dc){return P.ULS.sendTraceTag(537170055,0,10,
"CalcManager.ExtractReferenceWrappers - exception: {0}",dc.message),null}};l.prototype.extractLetVariables=function(ka,bb){if(!this.RDb)return this.Zbg||P.ULS.sendTraceTag(537170054,0,15,"CalcManager.ExtractLetVariables - parser not initialized"),null;var Ga=this.rsa(Ja.Range.ld(1,1));ka=this.RDb.parseFormula(excelOnlineCalc.parse.parseLocals(1,Ga.range),ka);if(!excelOnlineCalc.parse.parseResultHelper.isSuccess(ka))return P.ULS.sendTraceTag(537170053,0,10,"CalcManager.ExtractLetVariables - ParseFormula failed"),
null;try{return excelOnlineCalc.parse.parseResultHelper.extractLetVariables(ka,bb,this.Br.config.localeInfo)}catch(Ha){return P.ULS.sendTraceTag(537170052,0,10,"CalcManager.ExtractLetVariables - exception: {0}",Ha.message),null}};l.prototype.extractReferences=function(ka,bb,Ga,Ha){if(!bb)return P.ULS.sendTraceTag(537170051,0,10,"CalcManager.ExtractReferences - sheetName is null"),null;if(!Ga)return P.ULS.sendTraceTag(537170050,0,10,"CalcManager.ExtractReferences - documentName is null"),null;var Ua=
this.XOe(ka);if(!Ua)return P.ULS.sendTraceTag(537170049,0,15,"CalcManager.ExtractReferences - ExtractReferenceWrappers returned null"),null;try{return this.N3g(Ua,bb,Ga,ka,Ha)}catch(kb){return P.ULS.sendTraceTag(537170048,0,10,"CalcManager.ExtractReferences - exception: {0}",kb.message),null}};l.prototype.nSh=function(ka,bb,Ga,Ha){if(!ka)return P.ULS.sendTraceTag(537170019,0,10,"CalcManager.GetSubExpressionSpanForContextualFormulaPreview - range is null"),null;if(!bb||0>=bb.length)return P.ULS.sendTraceTag(537170018,
0,10,"CalcManager.GetSubExpressionSpanForContextualFormulaPreview - formula is null/empty"),null;ka=this.rsa(ka);if(!this.Br||!ka)return null;var Ua=this.Atb(ka).returnValue;if(!Ua||Ua.V4a)return null;Ga=excelOnline.utils.getCharIndexInTextFromPoint(Ga,Ha,pa.EwaSettings.la(622));return 0>Ga?null:excelOnlineCalc.runtime.getSubExpressionFromFormulaCharacterIndex(this.Br.config,Ga,bb,ka)};l.prototype.SOg=function(ka,bb,Ga,Ha){var Ua=this;if(!ka)return P.ULS.sendTraceTag(537170017,0,10,"CalcManager.CalcPartialResultsForFormula - range is null"),
null;var kb=null;return this.evalFormula(bb).then(function($a){var Xb=Ua.Br.Thh($a,Ga),dc=Xb.returnValue;8!==Xb.kind||dc.length&&dc!==ta.CalcHelper.unknownError?$a=0:(P.ULS.sendTraceTag(537170016,0,50,"EvalSession.GetPartialResultValueForFormula - EvalResultToString error"),$a=excelOnlineCalc.calc.getEvalFailureReason($a),void 0!==$a&&null!==$a||P.ULS.shipAssertTag(537170015,0,!1,"CalcHelper.GetEvalFailureReason() - result is not a failure, function should not be called"),$a=1);return kb=Ha?new Lb.a(dc,
Ha.start,Ha.end,$a):new Lb.a(dc,-1,-1,$a)},function($a){P.ULS.sendTraceTag(537170014,0,10,"EvalSession.GetPartialResultValueForFormula - exception: {0}",$a);return Promise.resolve(kb)})};l.prototype.getSubExpressionSpan=function(ka){return this.Br&&ka?excelOnlineCalc.runtime.getSubExpressionSpan(ka):null};l.prototype.getFormulaSubExpressionObject=function(ka,bb,Ga){return this.Br&&ka&&bb&&Ga?excelOnlineCalc.runtime.getFormulaSubExpressionObject(this.Br.config,bb,Ga,this.rsa(ka)):null};l.prototype.qSh=
function(ka,bb,Ga){return this.Br&&ka&&bb?excelOnlineCalc.runtime.getSubstitutedSubExpressionString(this.Br.config,bb,Ga,this.rsa(ka)):null};l.prototype.oSh=function(ka,bb,Ga){return this.Br&&ka&&bb?excelOnlineCalc.runtime.getSubExpressionSubspans(this.Br.config.localeInfo,bb,Ga):null};l.prototype.QLh=function(){return this.Br?this.Br.config.localeInfo.listSeparator:null};l.prototype.isFormulaSubExpressionVolatile=function(ka){return this.Br?excelOnlineCalc.runtime.isFormulaSubExpressionVolatile(this.Br.config.localeInfo,
ka):!1};l.prototype.rsa=function(ka){return ka&&this.Br?this.Br.i5g(this.Br.X6g(),ka.top-1,ka.left-1):null};l.prototype.Wai=function(ka,bb){ka=this.Idd(ka);if(void 0===ka||null===ka)return null;ka=this.Np.createFormat(ka.FormatString,ka.Builtin);if(!excelOnlineCalc.util.isSuccess(ka))return null;bb=this.Np.parseEdit(bb,ka.value);return excelOnlineCalc.util.isSuccess(bb)?bb.value.kind===Eb.a.formula:null};l.prototype.Hdd=function(ka){if(!ka.isValid())return P.ULS.sendTraceTag(537170013,0,50,"CalcManager.GetNumberFormat: invalid format was given! ifmt: {0}, format string: {1}, format obj: {2}",
null!=ka.mE?ka.mE.toString():"null",ka.formatString?Ma.a.dJ(ka.formatString):"null",ka.numberFormat?"!null":"null"),null;var bb=ka.DKh();if("String"===Object.getType(bb).getName())var Ga=this.Bpf;else if("Number"===Object.getType(bb).getName())Ga=this.ypf;else return P.ULS.sendTraceTag(537170012,0,10,"CalcManager.GetNumberFormat: key is of unknown type!"),null;bb=bb.toString();if(bb in Ga)return Ga[bb].numberFormat;Ga[bb]=ka;return ka.numberFormat};l.prototype.getWorksheetFuncId=function(ka){return this.localeInfo.getWorksheetFuncId(ka)};
l.prototype.N3g=function(ka,bb,Ga,Ha,Ua){for(var kb={Items:[]},$a=0;$a<ka.length;$a++){var Xb=ka[$a],dc={};dc.Start=Xb.span.start;dc.End=Xb.span.end;if(Ua||Xb.kind!==xb.a.func)if(Ua||Xb.kind!==xb.a.Qki){if(this.Och(Xb,bb,Ga)){var Za=new v,Wa=this.tPh(Xb,bb,Za,Ha);if(pa.EwaSettings.la(622)){var Ba=this.GLh(Xb),db=this.FLh(Xb);if(Wa||db&&0<=Ba)dc={Span:dc,LetNumber:Ba,LetName:db,Range:Wa},dc.IsRangeRef=Za.G5a,dc.IsAbsoluteFirstRow=Za.Mva,dc.IsAbsoluteFirstColumn=Za.Lva,dc.IsAbsoluteSecondRow=Za.ZKa,
dc.IsAbsoluteSecondColumn=Za.YKa,dc.IsStructRef=Xb.kind===xb.a.nRd,Array.add(kb.Items,dc)}else Wa&&(dc={Span:dc,Range:Wa},dc.IsRangeRef=Za.G5a,dc.IsAbsoluteFirstRow=Za.Mva,dc.IsAbsoluteFirstColumn=Za.Lva,dc.IsAbsoluteSecondRow=Za.ZKa,dc.IsAbsoluteSecondColumn=Za.YKa,dc.IsStructRef=Xb.kind===xb.a.nRd,Array.add(kb.Items,dc))}}else Xb=Xb.ref.value.oper.kind,Array.add(kb.Items,{Span:dc,IsString:2===Xb,IsBoolean:4===Xb,IsNumber:1===Xb});else dc.End=Xb.span.start+Xb.ref.name.length,Array.add(kb.Items,{Span:dc,
IsFunction:!0})}kb.Items.sort(function(Zb,Jb){return Zb.Span.Start-Jb.Span.Start});return kb};l.prototype.GLh=function(ka){return ka.kind===xb.a.khf?ka.ref.number:-1};l.prototype.FLh=function(ka){return ka.kind===xb.a.khf?ka.ref.name:null};l.prototype.tPh=function(ka,bb,Ga,Ha){if(ka.kind===xb.a.range)return Ga.G5a=!0,this.vze(ka,bb,Ga,Ha);if(ka.kind===xb.a.namedRange){Ga=ka.ref;(ka=this.$.xb.getItemByName(Ga.name))||(ka=this.$.xb.getItemByName(bb+"!"+Ga.name));if(!(ka&&ka.sheetName&&ka.usedRange&&
Ma.a.equals(ka.sheetName,bb,!0)))return null;bb=2===ka.type?Fa.a(ka):ka.usedRange;return lb.m(bb,ka)}if(ka.kind===xb.a.nRd){var Ua=ka.ref,kb;Ua.name?(kb=this.$.xb.getItemByName(Ua.name))||(kb=this.$.xb.getItemByName(bb+"!"+Ua.name)):kb=this.gridView.Vb.vk(this.gridView.ha.va.activeCell);if(!(kb&&kb.sheetName&&kb.usedRange&&Ma.a.equals(kb.sheetName,bb,!0)))return null;Ga.G5a=!1;return this.vze(ka,bb,Ga,Ha)}return null};l.prototype.vze=function(ka,bb,Ga,Ha){ka=ka.ref;if(ka.type){if(ka.type===Kb.a.column){var Ua=
ka.startIndex;ka=ka.endIndex;Ga.Lva=Ua.kind===Hc.a.abs;Ga.YKa=ka.kind===Hc.a.abs;return this.createRange(0,Ua.index,Q.a.Fh,ka.index,bb)}if(ka.type===Kb.a.row)return Ua=ka.endIndex,Ga.Mva=ka.startIndex.kind===Hc.a.abs,Ga.ZKa=Ua.kind===Hc.a.abs,this.createRange(ka.startIndex.index,0,ka.endIndex.index,Q.a.Qh,bb);if(ka.type===Kb.a.cell){Ua=ka.row;var kb=ka.col;Ga.Mva=Ga.ZKa=Ua.kind===Hc.a.abs;Ga.Lva=Ga.YKa=kb.kind===Hc.a.abs;return this.h0b(ka.span.end,Ha)&&(Ga=Ja.Range.ld(Ua.index+1,kb.index+1),Ga=this.gridView.Vb.V_e(Ga))?
lb.n(Ga,bb):this.createRange(Ua.index,kb.index,Ua.index,kb.index,bb)}if(ka.type===Kb.a.range){Ua=ka.top;kb=ka.left;Ha=ka.bottom;ka=ka.right;var $a=Math.min(Ua.index,Ha.index),Xb=Math.min(kb.index,ka.index),dc=Math.max(Ua.index,Ha.index),Za=Math.max(kb.index,ka.index);Ga.Mva=Ua.kind===Hc.a.abs;Ga.ZKa=Ha.kind===Hc.a.abs;Ga.Lva=kb.kind===Hc.a.abs;Ga.YKa=ka.kind===Hc.a.abs;return this.createRange($a,Xb,dc,Za,bb)}P.ULS.sendTraceTag(537170010,0,10,"CalcManager.CovertFormulaRefToRange: Unsupported formula ref type '{0}'",
ka.type);return null}P.ULS.sendTraceTag(537170011,0,15,"CalcManager.CovertFormulaRefToRange: traverseFormulaRef.Type is null");return null};l.prototype.h0b=function(ka,bb){return bb.length>=ka&&0<ka&&bb.charAt(ka-1)===u.pEf};l.prototype.XOg=function(ka,bb,Ga){this.rl&&this.rl.aPg(ka,bb,Ga)};l.prototype.Idd=function(ka){return this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.Jba&&this.instantaneousSupportInformationManager.Jba[ka]&&this.Np?this.instantaneousSupportInformationManager.Jba[ka]:
null};l.prototype.toXLNumber=function(ka){if(!this.Np)return null;ka=excelOnlineCalc.numfmt.toXLNumber(this.config.mathpack,this.Np,ka);return excelOnlineCalc.util.isSuccess(ka)?ka.value:null};l.prototype.PKj=function(ka,bb){if(ka){ka=yl(ka);for(var Ga=ka.next();!Ga.done;Ga=ka.next())if(Ga=Ga.value,Ga.ref.type&&Ga.ref.type===Kb.a.cell){var Ha=Ga.ref;l.FSi(Ha,bb)&&(Ha.span.end+=1,Ga.span.end+=1)}}};l.prototype.createRange=function(ka,bb,Ga,Ha,Ua){var kb={};kb.FirstRow=ka;kb.FirstColumn=bb;kb.LastRow=
Ga;kb.LastColumn=Ha;kb.SheetName=Ua;return kb};l.prototype.Och=function(ka,bb,Ga){var Ha=ka.ref.qualifier;if(!Ha)return!0;switch(ka.ref.qualifier.type){case f.sheet:return ka=Ha.document,Ma.a.equals(Ha.sheet,bb,!0)&&(!ka||Ma.a.equals(ka.document,Ga,!0));case f.sheetRange:return bb=this.$.xa.getItemByName(bb),Ga=this.$.xa.getItemByName(Ha.sheet1),Ha=this.$.xa.getItemByName(Ha.sheet2),!!bb&&!!Ga&&!!Ha&&(Ga.index<=bb.index&&bb.index<=Ha.index||Ha.index<=bb.index&&bb.index<=Ga.index);case f.document:return Ma.a.equals(Ha.document,
Ga,!0);case f.t1h:return Ha=Ha.name,Ma.a.equals(Ha,bb,!0)||Ma.a.equals(Ha,Ga,!0);default:return P.ULS.sendTraceTag(537170009,0,10,"CalcManager.GetQualifierData: Unsupported formula qualifier type '{0}'",Ha.type),!1}};l.prototype.yFj=function(ka){this.instantaneousSupportInformationManager=ka;ka.Jba.length&&ka.Jia.length?(this.QDc=new ta.CalcHelper(this.gridView.$),this.RDb=this.Br.createParser(),this.w$d=this.Br.createNumberFormatter(),this.T9e=!0,P.ULS.sendTraceTag(537170007,0,50,"CalcManager.TryInitializeInternal: calc initialized"),
this.rl||(P.ULS.sendTraceTag(537170006,0,50,"CalcManager creating calc engine"),this.rl=new m(this.$))):P.ULS.sendTraceTag(537170008,0,15,"CalcManager.TryInitializeInternal: IInstantaneousSupportInformationManager locale information missing, cannot initialize calc. number formats count = {0}, functions info count = {1}",ka.Jba.length,ka.Jia.length.toString())};l.prototype.Atb=function(ka){if(!ka)return{returnValue:null,emptyCell:!1};var bb=this.getSheetName(ka.sheet.index);if(!bb)return P.ULS.sendTraceTag(537169998,
0,50,"CalcManager.GetCellFromBlockCache: No sheet index {0}",ka.sheet.index),{returnValue:null,emptyCell:!1};var Ga=l.convertToRange(ka);bb=this.gridView.Atb(bb,Ga.top,Ga.left);return bb?bb.Jch?{returnValue:bb,emptyCell:!1}:(P.ULS.sendTraceTag(537169996,0,50,"CalcManager.GetCellFromBlockCache: cell {0} {1} is empty",ka.range.row,ka.range.col),{returnValue:null,emptyCell:!0}):(P.ULS.sendTraceTag(537169997,0,50,"CalcManager.GetCellFromBlockCache: cellProxy is null for cell {0} {1}",ka.range.row,ka.range.col),
{returnValue:null,emptyCell:!1})};l.prototype.getSheetName=function(ka){var bb=this.gridView.$.xa.getItem(ka);return bb?bb.sheetName:(P.ULS.sendTraceTag(537169995,0,50,"CalcManager.GetSheetName - no sheet in index {0}",ka),null)};l.prototype.L4g=function(ka,bb){var Ga={allowUnqualifiedCell:!0,wrapCellReferences:!0};Ga.config=this.Br.config;Ga.originGridCell=excelOnlineCalc.util.success(ka);Ga.originSheet=excelOnlineCalc.util.success(bb);return Ga};l.prototype.K4g=function(){var ka={};ka.config=this.Br.config;
ka.getNameLoc=Object(ya.a)(this.rl,this.rl.getNameLoc,"getNameLoc");ka.getContainingTable=Object(ya.a)(this.rl,this.rl.getContainingTable,"getContainingTable");ka.getStructRefColumn=Object(ya.a)(this.rl,this.rl.getStructRefColumn,"getStructRefColumn");ka.getStructRefSpecialRef=Object(ya.a)(this.rl,this.rl.getStructRefSpecialRef,"getStructRefSpecialRef");ka.getDocumentLoc=Object(ya.a)(this.rl,this.rl.getDocumentLoc,"getDocumentLoc");ka.getSheetIndex=Object(ya.a)(this.rl,this.rl.getSheetIndex,"getSheetIndex");
ka.getSheetName=Object(ya.a)(this.rl,this.rl.getSheetName,"getSheetName");ka.getUserDefinedFuncLoc=Object(ya.a)(this.rl,this.rl.getUserDefinedFuncLoc,"getUserDefinedFuncLoc");ka.getSheetRangeIndexes=Object(ya.a)(this.rl,this.rl.getSheetRangeIndexes,"getSheetRangeIndexes");return ka};l.FSi=function(ka,bb){return bb.length>ka.span.end&&bb.charAt(ka.span.end)===u.pEf};l.convertToRange=function(ka){return Ja.Range.ld(ka.range.row+1,ka.range.col+1)};tl.Object.defineProperties(l.prototype,{Br:{configurable:!0,
enumerable:!0,get:function(){return this.QDc}},gridView:{configurable:!0,enumerable:!0,get:function(){return this.ny}},$:{configurable:!0,enumerable:!0,get:function(){return this.vb}},Np:{configurable:!0,enumerable:!0,get:function(){return this.w$d}},localeInfo:{configurable:!0,enumerable:!0,get:function(){return this.Br?this.Br.config.localeInfo:null}},config:{configurable:!0,enumerable:!0,get:function(){return this.Br.config}}});Object(D.a)(l,"CalcManager",null,[337,3]);var wd=b(35),Tc=b(51),ub=
ia.a;vm(n,ub);n.prototype.create=function(){var ka=this;if(this.$){P.ULS.sendTraceTag(537169993,0,50,"CalcManagerFactory.Create: Start loading script");if(pa.EwaSettings.isChangeGateEnabled("OfficeVSO:5543503_loadCalcCurrentVersion")){var bb=53;var Ga="Current"}else bb=56,Ga="Stable";P.ULS.sendTraceTag(537169992,0,50,"CalcManagerFactory.Create: Calc {0} JS was loaded",Ga);wd.TaskExtensions.Ba(Tc.a.loadScript(bb,4,this.tb,void 0,void 0,265),function(){P.ULS.sendTraceTag(537169991,0,50,"CalcManagerFactory.Create: Raised create service event");
var Ha=ka.$.da.Aa(266,!1);Ha||(P.ULS.sendTraceTag(537169990,0,50,"CalcManagerFactory.Create: CalcManager is not registered, creating new CalcManager"),Ha=new l(ka.$));ka.Fb(Ha)},this.ma,3)}else P.ULS.sendTraceTag(537169994,0,50,"CalcManagerFactory.Create: ewaControl is null, cann't create the service")};n.ja=function(ka){ka&&ka.da&&ka.da.Ha(265,new n(ka))};Object(D.a)(n,"CalcManagerFactory",ia.a,[]);var fb=b(4),Ta=b(318);Object(D.a)(k,"MarqueeMetadata",null,[]);var eb=b(129),tb=b(647),rc=b(336);c.prototype.XW=
function(ka,bb){this.pci&&ka.textBox.addEventLogRecord("ColoredReferencesManager.TryUpdateColoredReferences");if(this.P3f||ka.DM)return!1;var Ga=void 0===bb||null===bb?ka.text:bb;if(this.calcManager&&1<Ga.length&&Xa.e(Ga)){var Ha=this.Wdd(),Ua=this.$Ye(),kb=this.Nc.workbookContext.WorkbookFileName,$a=!1,Xb=.01>Math.random()?Object(Gb.a)(eb.a,this.Nc.Ub.Fc("LoadingUIShown","ColoredReferencesManager")):null;try{var dc=this.calcManager.extractReferences(Ga,Ua,kb,!this.z9e);if(!dc)return P.ULS.sendTraceTag(537169989,
0,50,"ColoredReferencesManager.UpdateColoredReferences: extractReferences is null (might be an invalid formula)"),!1;Ua=[];kb=[];for(var Za=[],Wa=[],Ba=0,db=0,Zb=new wa.a(!1),Jb="",Ic=yl(dc.Items),uc=Ic.next();!uc.done;uc=Ic.next()){var za=uc.value;$a=za.IsStructRef||$a;if(za.IsBoolean||za.IsNumber||za.IsString){var pb=za.IsBoolean?c.oKg:za.IsNumber?c.mxi:c.xyj;this.ZEa(kb,Ga,Ba,za.Span.Start,null);this.ZEa(kb,Ga,za.Span.Start,za.Span.End,pb);Ba=za.Span.End}else if(pa.EwaSettings.la(622)){if(za.Range||
za.LetName&&0<=za.LetNumber){dc=null;if(za.Range){var cc=lb.D(za.Range);dc=this.Gtb(cc,Zb,1);Array.add(Ua,new rc.a(cc,Ha))}else za.LetName&&0<=za.LetNumber&&(dc=Jb=this.kFh(za.LetName,za.LetNumber,Zb,Jb),db!==Zb.count&&ka.colors.add(za.Span.Start+"-"+za.Span.End,this.colors[(Zb.count-1)%this.colors.length]));this.ZEa(kb,Ga,Ba,za.Span.Start,null);this.ZEa(kb,Ga,za.Span.Start,za.Span.End,dc);Ba=za.Span.End;Array.add(Za,za.Span);var Ac=kb.length-1;Array.add(Wa,new k(Ac,kb[Ac].text,za));db=Zb.count}}else if(za.Range){var ad=
lb.D(za.Range),Jd=this.Gtb(ad,Zb,1);this.ZEa(kb,Ga,Ba,za.Span.Start,null);this.ZEa(kb,Ga,za.Span.Start,za.Span.End,Jd);Array.add(Ua,new rc.a(ad,Ha));Ba=za.Span.End;Array.add(Za,za.Span);var Xd=kb.length-1;Array.add(Wa,new k(Xd,kb[Xd].text,za))}}this.ZEa(kb,Ga,Ba,Ga.length,null);this.Rlj(ka,kb,!!bb);var od=ka.textBox.text;if(!Ma.a.equals(od,Ga,!1)){P.ULS.shipAssertTag(38114182,0,!1,"ColoredReferencesManager.UpdateColoredReferences: The text we created is different from the original text. Setting the original text back. currentTextLength [{0}], originalTextLength [{1}]",
od.length,Ga.length);var Je=ka.textBox.caretPosition;ka.textBox.text=Ga;ka.textBox.caretPosition=Je;return!0}this.tcc(Ua,Zb,Wa);pa.EwaSettings.la(622)&&0<Ua.length&&P.ULS.sendTraceTag(537169988,0,50,"ColoredReferencesManager.UpdateColoredReferences: Cell reference(s) colored");pa.EwaSettings.la(622)&&0<ka.colors.count&&P.ULS.sendTraceTag(537169987,0,50,"ColoredReferencesManager.UpdateColoredReferences: Let name(s) colored");return this.q4a=!0}finally{Xb&&Xb.mAa(function(){$a&&P.ULS.sendTraceTag(537169986,
0,50,"ColoredReferencesManager.UpdateColoredReferences: Formula with structured reference is highlighted in {0} ms",Xb.Ac)})}}else return this.tcc(null,null),this.q4a&&(this.q4a=!1,Ha=ka.textBox.caretPosition,ka.textBox.setPlainText(Ga),ka.textBox.caretPosition=Math.min(Ha,Ga.length),bb)?!0:!1};c.prototype.fnf=function(ka,bb,Ga){if(!ka||!bb||!Ga)return P.ULS.shipAssertTag(537169985,0,!!ka,"ColoredReferencesManager.MoveMarqueeRange: cellContentEditor is null"),P.ULS.shipAssertTag(537169984,0,!!bb,
"ColoredReferencesManager.MoveMarqueeRange: highlightState is null"),P.ULS.shipAssertTag(537169955,0,!!Ga,"ColoredReferencesManager.MoveMarqueeRange: newRange is null"),!1;var Ha=Object(Gb.a)(k,bb.metadata);if(!Ha)return P.ULS.shipAssertTag(537169954,0,!1,"ColoredReferencesManager.MoveMarqueeRange: marqueeMetadata is null"),!1;var Ua=Ha.dBj,kb=Ha.U4f,$a=this.gridView.Vb.R$e(Ga)?Ga.k$b(Ha.Lva,Ha.Mva):Ga.a3a(Ha.Lva,Ha.Mva,Ha.YKa,Ha.ZKa);if(!$a)return P.ULS.shipAssertTag(537169953,0,!1,"ColoredReferencesManager.MoveMarqueeRange: newText is null"),
!1;var Xb=kb.indexOf("!");-1!==Xb&&($a=kb.substring(0,Xb+1)+$a);if(!ka.textBox.changeTextInExistingTextPart(Ua,kb,$a))return P.ULS.shipAssertTag(38926105,0,!1,"ColoredReferencesManager.MoveMarqueeRange: failed to change the text part"),!1;Ha.U4f=$a;Ua=!0;for(kb=1;4>=kb;kb++)($a=Cb.g(this.Nc).Nb.OG(3,kb,bb.X9))?($a.range=Ga,$a.metadata=Ha):(P.ULS.shipAssertTag(537169952,0,!1,"ColoredReferencesManager.MoveMarqueeRange: highlightStateInPane is null"),Ua=!1);this.gridView.Nb.update(!1,!1);this.gridView.rc.xj&&
(this.gridView.rc.textBox.text=ka.text);this.gridView.rc.XEb(new Ta.a(!0));return Ua};c.prototype.tci=function(ka){if(3!==ka.Wq)return P.ULS.shipAssertTag(537169951,0,!1,"ColoredReferencesManager.IsMarqueeHighlightDragable: not HighlightDivIndex.Marquee."),!1;ka=Object(Gb.a)(k,ka.metadata);return ka?ka.G5a&&!ka.Tfc:(P.ULS.shipAssertTag(537169950,0,!1,"ColoredReferencesManager.IsMarqueeHighlightDragable: marqueeMetadata is null."),!1)};c.prototype.Mcb=function(ka,bb){P.ULS.sendTraceTag(537169949,0,
50,"ColoredReferencesManager.SuspendResumeColoredReferences: "+(bb?"suspending":"resuming")+" colored references");!bb||this.gef&&!this.q4a||(this.gef&&(this.q4a=!1),this.tcc(null,null),ka.textBox.LTg());this.P3f=bb};c.prototype.dispose=function(){this.gridView&&this.gridView.Kc&&this.gridView.Kc.Rp(this.OBb)};c.prototype.s0h=function(ka){var bb=this.Wdd(),Ga=this.$Ye(),Ha=this.Nc.workbookContext.WorkbookFileName,Ua=[],kb=new wa.a(!1),$a=[];if(Ga=this.calcManager.extractReferences(ka,Ga,Ha,!this.z9e)){Ga=
yl(Ga.Items);for(Ha=Ga.next();!Ha.done;Ha=Ga.next())if(Ha=Ha.value,Ha.Range){var Xb=lb.D(Ha.Range);Array.add(Ua,new rc.a(Xb,bb));this.Gtb(Xb,kb,1);Array.add($a,new k(Ha.Span.Start,ka.substring(Ha.Span.Start,Ha.Span.End),Ha,!0))}this.tcc(Ua,kb,$a)}};c.prototype.Gtb=function(ka,bb,Ga){var Ha=bb.getItem(ka.toString());Ha||(Ha=this.colors[bb.count%this.colors.length],bb.add(ka.toString(),Ha));return String.format(Ha,Ga)};c.prototype.kFh=function(ka,bb,Ga,Ha){ka="["+ka+", "+bb+"]";bb=Ga.getItem(ka);bb||
(bb=Ga.count%this.colors.length,bb=this.colors[bb],Ha===String.format(bb,1)&&(Ga.add("skip-"+ka,bb),bb=Ga.count%this.colors.length,bb=this.colors[bb]),Ga.add(ka,bb));return String.format(bb,1)};c.prototype.ZEa=function(ka,bb,Ga,Ha,Ua){P.ULS.shipAssertTag(537169948,0,Ga<=Ha,"ColoredReferencesManager.AddTextPart: startIndex cannot be larger than endIndex");Ga<Ha&&(bb=bb.substring(Ga,Ha),Array.add(ka,Object.assign(new tb.a,{text:bb,color:Ua})))};c.prototype.tcc=function(ka,bb,Ga){var Ha=this;Ga=void 0===
Ga?null:Ga;ka&&ka.length?(P.ULS.sendTraceTag(537169947,0,50,"ColoredReferencesManager.HighlightRanges: number of ranges to highlight: "+ka.length),ka.reverse(),Ga.reverse(),this.gridView.Nb.uw(ka,[3],!0,function(Ua,kb){if(Ua&&Ua.range&&kb){P.ULS.shipAssertTag(537169943,0,bb.wb(Ua.range.toString()),"ColoredReferencesManager.HighlightRanges: The range '{0}' doesn't exist in the range to color dictionary",Ua.range.toString());var $a=Ha.Gtb(Ua.range,bb,.1),Xb=Ha.Gtb(Ua.range,bb,1);Ha.Nc.frame&&Ha.Nc.frame.XG&&
Ha.Nc.frame.XG.eka||(kb.style.background=$a);kb.style.borderColor=Xb;Ga&&(kb.setAttribute(fb.a.wwb,Ua.X9.toString()),Ua.metadata=Ga[Ua.X9])}else P.ULS.shipAssertTag(537169946,0,!!Ua,"ColoredReferencesManager.HighlightRanges: state is null"),P.ULS.shipAssertTag(537169945,0,!!Ua.range,"ColoredReferencesManager.HighlightRanges: state.Range is null"),P.ULS.shipAssertTag(537169944,0,!!kb,"ColoredReferencesManager.HighlightRanges: div is null")})):(ka=this.Nc.Ub.Fc("UserAction","HideRangesHighlightsStopwatch"),
this.gridView.Nb.kl([3]),this.gridView.Nb.CIb(new rc.a(null,this.Wdd()),[3]),ka.stop())};c.prototype.Rlj=function(ka,bb,Ga){var Ha=ka.textBox;Ha.QJ=!0;var Ua=Ha.selection,kb=Ua.index;Ua=kb+Ua.length;Ha.setTextFromTextParts(bb);bb=Ha.text.length;Ha.selectRange(Math.min(kb,bb),Math.min(Ua,bb));Ga&&ka.XEb(new Ta.a);Ha.QJ=!1};c.prototype.Wdd=function(){return this.ZYe().sheetId};c.prototype.$Ye=function(){return this.ZYe().sheetName};c.prototype.ZYe=function(){return this.gridView.Ts&&this.gridView.Ts.rK?
this.gridView.Ts.rK:this.Nc.oa};c.mxi="rgba(9, 134, 88, 1)";c.oKg="rgba(0, 0, 255, 1)";c.xyj="rgba(163, 21, 21, 1)";Object(D.a)(c,"ColoredReferencesManager",null,[396,3]);var wb=ia.a;vm(d,wb);d.prototype.create=function(){var ka=this;this.$.da.Za(266,function(bb){ka.Fb(new c(ka.$,bb))})};d.ja=function(ka){ka.da.Ha(282,new d(ka))};Object(D.a)(d,"ColoredReferencesManagerFactory",ia.a,[]);var E=b(935),Mb=ia.a;vm(a,Mb);a.prototype.create=function(){var ka=this;this.$.da.Za(266,function(bb){ka.Fb(new E.RelativeAndAbsoluteReferencesManager(bb))})};
a.ja=function(ka){ka.da.Ha(295,new a(ka))};Object(D.a)(a,"RelativeAndAbsoluteReferencesManagerFactory",ia.a,[]);Type.registerNamespace("_Ewa");y.a.Ga(w.ja);y.a.Ga(n.ja);y.a.Ga(d.ja);y.a.Ga(a.ja)},923:function(y,D,b){function a(){}b.d(D,"a",function(){return a});y=b(0);a.abs="Abs";a.rel="Rel";Object(y.a)(a,"PositionBaseType",null,[])},935:function(y,D,b){function a(B){this.calcManager=B}function d(){return v.call(this)||this}function c(){this.Usc=this.firstRow=null;return this}function k(){return v.call(this)||
this}function n(){this.right=this.left=this.bottom=this.top=null;return this}function l(){return v.call(this)||this}function f(){this.Tsc=this.firstColumn=null;return this}function u(){var B=v.call(this)||this;B.Sfc=!1;return B}function v(){this.end=this.start=0;this.Uu=null}function m(){this.column=this.row=null;return this}function A(){}b.r(D);y=b(0);var x=b(13);Object(y.a)(A,"Reference",null,[]);vm(m,A);Object(y.a)(m,"CellReference",A,[]);v.prototype.TFg=function(B,U){for(var N=0;N<this.Uu.length;N++){var P=
this.UYb(B,this.Uu[N]);U+=P;N<this.Uu.length-1&&(U+=":")}return U};Object(y.a)(v,"IReferenceSequence",null,[]);var t=b(24),z=b(923);vm(u,v);u.prototype.dac=function(){var B=b(935).RelativeAndAbsoluteReferencesManager,U=this.Uu[0];return B.lof(U.row.kind===z.a.abs,U.column.kind===z.a.abs)};u.prototype.UYb=function(B,U){U=t.Range.ld(U.row.index+1,U.column.index+1);return this.Sfc?U.k$b(1===B||3===B,1===B||2===B):U.a3a(1===B||3===B,1===B||2===B,!0,!0)};Object(y.a)(u,"CellReferenceSequence",v,[]);vm(f,
A);Object(y.a)(f,"ColumnReference",A,[]);vm(l,v);l.prototype.dac=function(){var B=this.Uu[0];return b(935).RelativeAndAbsoluteReferencesManager.Imf(B.firstColumn,B.Tsc).kind===z.a.abs?2:3};l.prototype.UYb=function(B,U){return t.Range.btb(U.firstColumn.index+1,U.Tsc.index+1).a3a(1===B||3===B,!0,1===B||3===B,!0)};Object(y.a)(l,"ColumnReferenceSequence",v,[]);vm(n,A);Object(y.a)(n,"RangeReference",A,[]);vm(k,v);k.prototype.dac=function(){var B=b(935).RelativeAndAbsoluteReferencesManager,U=this.Uu[0];
return B.lof(U.top.kind===z.a.abs,U.left.kind===z.a.abs)};k.prototype.UYb=function(B,U){U=new t.Range(U.top.index+1,U.left.index+1,U.bottom.index+1,U.right.index+1,!1,!1);var N=1===B||3===B;B=1===B||2===B;return U.a3a(N,B,N,B)};Object(y.a)(k,"RangeReferenceSequence",v,[]);vm(c,A);Object(y.a)(c,"RowReference",A,[]);vm(d,v);d.prototype.dac=function(){var B=this.Uu[0];return b(935).RelativeAndAbsoluteReferencesManager.Imf(B.firstRow,B.Usc).kind===z.a.abs?0:1};d.prototype.UYb=function(B,U){return t.Range.T8b(U.firstRow.index+
1,U.Usc.index+1).a3a(!0,1===B||2===B,!0,1===B||2===B)};Object(y.a)(d,"RowReferenceSequence",v,[]);var r=b(1133),G=b(1134),w=b(194);b.d(D,"RelativeAndAbsoluteReferencesManager",function(){return a});a.prototype.U_a=function(B,U,N){var P=U;var ia=N;if(!B||!w.e(B))return{returnValue:B,zvd:P,yvd:ia};var W=this.calcManager.XOe(B);if(!W)return x.ULS.sendTraceTag(537169940,0,15,"RelativeAndAbsoluteReferencesManager.CycleThroughRelativeAndAbsoluteReferences: Couldn't extract references (might be invalid formula)"),
{returnValue:null,zvd:P,yvd:ia};W=this.cRh(W,B,U,N);for(var R=0,I="",Q=0,O=0;O<W.length;O++)if(this.rGe(W[O],U,N)){R=W[O].dac();P=W[O].start;break}for(;O<W.length&&this.rGe(W[O],U,N);O++)I+=B.substring(Q,W[O].start),I=W[O].TFg(R,I),Q=W[O].end;Q&&(ia=I.length);I+=B.substring(Q,B.length);return{returnValue:I,zvd:P,yvd:ia}};a.prototype.cRh=function(B,U,N,P){for(var ia=[],W=0;W<B.length;W++){var R=B[W];if(R.kind===r.a.range)if(R=R.ref,R.type===G.a.cell){var I=R;R=Object.assign(new u,{start:R.span.start,
end:R.span.end,Uu:[Object.assign(new m,{column:I.col,row:I.row})],Sfc:this.calcManager.h0b(R.span.end,U)});ia.push(R)}else if(R.type===G.a.range)this.sGe(R.topLeftSpan,N,P)&&this.sGe(R.bottomRightSpan,N,P)?(I=new n,R.top.index<=R.bottom.index?(I.top=R.top,I.bottom=R.bottom):(I.bottom=R.top,I.top=R.bottom),R.left.index<=R.right.index?(I.left=R.left,I.right=R.right):(I.right=R.left,I.left=R.right),R=Object.assign(new k,{start:R.topLeftSpan.start,end:R.bottomRightSpan.end,Uu:[I]}),ia.push(R)):(I=Object.assign(new u,
{start:R.topLeftSpan.start,end:R.topLeftSpan.end,Uu:[Object.assign(new m,{column:R.left,row:R.top})],Sfc:this.calcManager.h0b(R.topLeftSpan.end,U)}),R=Object.assign(new u,{start:R.bottomRightSpan.start,end:R.bottomRightSpan.end,Uu:[Object.assign(new m,{column:R.right,row:R.bottom})],Sfc:this.calcManager.h0b(R.topLeftSpan.end,U)}),ia.push(I),ia.push(R));else if(R.type===G.a.column){I=R;for(R=Object.assign(new l,{start:R.span.start,end:R.span.end,Uu:[Object.assign(new f,{firstColumn:I.startIndex,Tsc:I.endIndex})]});R.end<
U.length-1&&":"===U.charAt(R.end)&&W<B.length-1;)if(I=B[W+1].ref,I.type===G.a.column&&I.span.start===R.end+1){var Q=I;R.Uu.push(Object.assign(new f,{firstColumn:Q.startIndex,Tsc:Q.endIndex}));R.end=I.span.end;W++}else break;ia.push(R)}else if(R.type===G.a.row){I=R;for(R=Object.assign(new d,{start:R.span.start,end:R.span.end,Uu:[Object.assign(new c,{firstRow:I.startIndex,Usc:I.endIndex})]});R.end<U.length-1&&":"===U.charAt(R.end)&&W<B.length-1;)if(I=B[W+1].ref,I.type===G.a.row&&I.span.start===R.end+
1)Q=I,R.Uu.push(Object.assign(new c,{firstRow:Q.startIndex,Usc:Q.endIndex})),R.end=I.span.end,W++;else break;ia.push(R)}}return ia};a.prototype.rGe=function(B,U,N){return!(B.start>N||U>B.end)};a.prototype.sGe=function(B,U,N){return!(B.start>N||U>B.end)};a.Imf=function(B,U){return B.index<=U.index?B:U};a.lof=function(B,U){return U||B?U&&B?2:!U&&B?3:0:1};Object(y.a)(a,"RelativeAndAbsoluteReferencesManager",null,[338])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDS.calc.js.map/a9f176e02416cec65a10537d404a0274/EwaDS.calc.js.map