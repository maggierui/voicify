(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[17],{1056:function(y,D,b){b.d(D,"a",function(){return a});y=b(0);var a;(function(d){d[d.unknown=0]="unknown";d[d.supported=1]="supported";d[d.userUnsupportedAnonymous=2]="userUnsupportedAnonymous";d[d.userUnsupportedNoLoginHint=3]="userUnsupportedNoLoginHint";d[d.hostUnsupported=4]="hostUnsupported"})(a||(a={}));Object(y.b)("SupportStatus",a)},1402:function(y,D,b){function a(W){var R=ia.call(this)||this;R.$=W;R.dc();return R}
function d(W){this.oAuthManager=W}function c(){}function k(W){this.TSb=W}function n(){}function l(){}b.r(D);y=b(0);var f=b(13),u=b(985),v=b(1056),m=b(5),A=b(93),x=b(857),t=b(274),z=b(47),r=b(23),G=b(86),w=b(178);l.prototype.di=function(W){W.register(574,"Common.App.OAuth.IOAuthManager").zc().Ic(function(){return new u.OAuthManager})};l.prototype.init=function(){var W=G.a.instance.resolve("Common.App.OAuth.IOAuthManager");this.fGj(W)};l.prototype.fGj=function(W){var R=m.AFrameworkApplication.ga.Ua("FileSource");
if(m.AFrameworkApplication.ga.ra("IsO365ConsumerHost")||m.AFrameworkApplication.ga.ra("IsO365CommercialHost")||"WopiTest"===R){var I=x.a.dzh,Q=x.a.authority;if(void 0!==I&&null!==I&&I.length&&void 0!==Q&&null!==Q&&Q.length){var O=v.a[W.iS],ba=r.a.TFa,ca=W.Cu();try{var S=new Map;void 0!==S&&null!==S?(S.set("SupportStatus",O),S.set("Browser",ba),S.set("AuthStrategy",ca)):S=null}catch(na){S=null}A.Health.instance.recordKpiUsageForAlertableKpi("WacCorePFT","WacOAuthFC",S);var Y=z.a.se();W.YR("Core",I).then(function(na){var Z=
Math.floor(z.a.se()-Y);O=v.a[W.iS];ba=r.a.TFa;ca=W.Cu();f.ULS.sendTraceTag(562943369,3E3,50,'OAuthManager attempted to get a Core token to the WAC FrontEnd API in {0} ms. Success={1}, SupportStatus={2}, ErrorCode="{3}", Host="{4}", Browser="{5}", AuthStrategy="{6}"',Z,na.IsSuccess,O,na.ErrorCode,R,ba,ca);S&&(S.set("SupportStatus",O),S.set("Browser",ba),S.set("AuthStrategy",ca));Z=Object.assign(new w.a,{durationMs:Z,extendedProperties:S});na.IsSuccess?A.Health.instance.recordKpiSuccess("WacCorePFT",
Z):A.Health.instance.recordKpiFailure("WacCorePFT",na.ErrorCode,!1,!1,Z)})}}};l.prototype.dispose=function(){};l.main=function(){t.a.instance.mj(new l)};tl.Object.defineProperties(l.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.OAuth.OAuthPackage"}}});Object(y.a)(l,"OAuthPackage",null,[4,5]);var B=b(1083);Object(y.a)(n,"LokiTokenResult",null,[]);k.prototype.udd=function(){var W=this,R=this.ZLh();return R?k.dnd?new Promise(function(I,Q){W.TSb.continueWith(function(){W.TSb.Ch||
W.TSb.jg?Q(Error.create("Error downloading auth library")):W.TSb.result.YR("Loki",R).then(function(O){O=m.AFrameworkApplication.ga.ra("ForceLokiFallbackToACLPTokenIsEnabled")?W.bMh():O.IsSuccess&&O.Token?Object.assign(new n,{isSuccess:!0,token:O.Token,errorMessage:null}):Object.assign(new n,{isSuccess:!1,token:null,errorMessage:JSON.stringify(O)});I(O);return O})})}):Promise.resolve(Object.assign(new n,{isSuccess:!1,token:null,errorMessage:"Not attempting to fetch token because host is not an O365 host."})):
Promise.resolve(Object.assign(new n,{isSuccess:!1,token:null,errorMessage:String.format("Could not get Loki App Id for HostAuthorityType: [{0}]",B.a.cUe())}))};k.prototype.bMh=function(){var W=m.AFrameworkApplication.ga.Ua("LokiUserDataSignature")||"";return Object.assign(new n,{isSuccess:!0,token:W,errorMessage:null})};k.prototype.ZLh=function(){var W=null,R=B.a.s9b();2===R?W=m.AFrameworkApplication.ga.Ua("LokiAADAppId"):1===R&&(W=m.AFrameworkApplication.ga.Ua("LokiMSAAppId"));return W};tl.Object.defineProperties(k,
{dnd:{configurable:!0,enumerable:!0,get:function(){return m.AFrameworkApplication.ga.ra("IsO365CommercialHost")||m.AFrameworkApplication.ga.ra("IsO365ConsumerHost")}}});Object(y.a)(k,"LokiTokenManager",null,[611]);var U=b(524);c.prototype.init=function(){G.a.instance.resolve("Common.ILokiTokenManager")};c.prototype.dispose=function(){};c.prototype.di=function(W){W.register(k,"Common.App.LivePersonaUtils.LokiTokenManager").as("Common.ILokiTokenManager").zc().Ic(function(){return new k(U.a.Fq(W.mc("Common.App.OAuth.IOAuthManager")))})};
c.main=function(){t.a.instance.mj(new c)};tl.Object.defineProperties(c.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.LivePersonaUtils"}}});Object(y.a)(c,"LivePersonaUtilsPackage",null,[4,5]);var N=b(10);D=b(216);var P=b(947);d.prototype.YR=function(W,R){return this.oAuthManager?this.oAuthManager.YR(W,R).then(function(I){I.IsSuccess||f.ULS.sendTraceTag(51401292,0,15,"Error retrieving auth token. Message: "+I.ErrorMessage+" Error code: "+I.ErrorCode+" App name: "+W);
return Object.assign(new P.a,{IsSuccess:I.IsSuccess,Token:I.Token,ErrorCode:I.ErrorCode,ErrorMessage:I.ErrorMessage})}):(f.ULS.sendTraceTag(537154971,0,10,"Oauth manager is null"),Promise.resolve(Object.assign(new P.a,{IsSuccess:!1,Token:null,ErrorCode:"FailedToResolve",ErrorMessage:"Failed to resolve IOAuthManager from the container."})))};d.prototype.gLa=function(){return this.oAuthManager?this.oAuthManager.gLa():null};Object(y.a)(d,"OAuthManagerWrapper",null,[306]);var ia=D.a;vm(a,ia);a.prototype.create=
function(){this.Fb(this.$.da.Aa(349)||new d(G.a.instance.resolve("Common.App.OAuth.IOAuthManager")))};a.ja=function(W){W.da.Ha(350,new a(W))};Object(y.a)(a,"OAuthManagerFactory",D.a,[]);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.AppsForOfficeCommon");Type.registerNamespace("Common.App.OAuth");l.main();Type.registerNamespace("Common.App.LivePersonaUtils");c.main();(function(){N.a.Ga(function(W){a.ja(W)})})()},985:function(y,D,b){function a(pa){var Ia=this;pa=void 0===pa?null:
pa;this.iS=0;this.vO=null;this.lqg=0;var Ma=na.a.se();this.Slg=this.w$g(pa).then(function(ob){return ob?Ia.D2h():(t.ULS.sendTraceTag(527827277,3E3,15,"DetermineAuthLibrary failed leaving {0} in {1} ms, all future TryGetToken requests will fail.",Ia.Cu(),Math.floor(na.a.se()-Ma)),ob=Ia.kq(),void 0!==ob&&null!==ob&&(ob.set("AuthLibrary",Ia.Cu()),ob=Object.assign(new wa.a,{durationMs:Math.floor(na.a.se()-Ma),extendedProperties:ob}),Y.Health.instance.recordKpiFailure(a.kpiName,"StrategyPickFailed",!1,
!0,ob)),Promise.resolve(1))}).then(function(ob){return ob?Promise.resolve(ob):Ia.Vki()})}function d(pa){this.uNc=pa;this.BWa="UnsupportedAuthTokenStrategy Reason="+r.a[this.uNc]}function c(){this.ls=null;this.lRb=0;this.Fib=this.OWa=this.gDc=this.hDa=this.wL=this.$fe=null;this.pv=new S.a(null,null);this.VVb=B.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthVNext",!1);this.BWa="SharedAuthTokenStrategy "+(this.VVb?"BrowserAuth 1.20210701.2/MSAL 2.11.0":"BrowserAuth 1.20210426.1/MSAL 2.11.0");
this.NX=U.a.Hnj;this.$de=U.a.Gnj;this.a3d=U.a.enableConsoleLogging;this.Ejg=B.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthPopupFlashEnabled",!1);this.Vrg=B.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthSkipUpnCheckEnabled",this.VVb);this.mqa={};this.cmg=new l(1500)}function k(pa,Ia,Ma,ob,Cb,Xa,Sb){var Tb=ca.call(this,!1,!1,!0)||this;Tb.c1=null;Tb.p2d=null;Tb.NX=pa;Tb.Fpg=Ma;Tb.pv=ob;Tb.vtg=Cb;Tb.hDa=Xa;Tb.ls=document.createElement("iframe");
Tb.ls.id="SharedAuthInteractiveFrame";Tb.ls.setAttribute("name","SharedAuthInteractiveFrame");Tb.ls.setAttribute("title","SharedAuthInteractiveFrame");Tb.ls.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");Tb.ls.style.border="0";Tb.ls.style.height="48px";Tb.ls.style.width="190px";$addHandler(Tb.ls,"error",Object(ia.a)(Tb,Tb.rKi,"onSharedAuthFrameError"));pa=String.format("{0}{1}{2}{3}{4}{5}{6}{7}{8}",Tb.NX,Ia,"?replyUrl=",window.location.protocol,"//",window.location.host,
"&interactive=1","&WacUserType=",B.AFrameworkApplication.userType);Sb&&(pa+="&vnext=1");Tb.ls.src=pa;Tb.kjg=new Promise(function(da){Tb.p2d=da});Tb.q2d=!1;return Tb}function n(){this.correlationId=this.resolve=null}function l(pa){pa=void 0===pa?0:pa;this.lB=0;this.yjb=!1;this.vm=new R.a;this._timeout=pa}function f(){this.reject=this.resolve=null;this.startTime=0;this.qGf=this.Gqe=null}function u(){this.ahe=null;var pa=B.AFrameworkApplication.ga.Ua(B.AFrameworkApplication.Pna),Ia=B.AFrameworkApplication.ga.Ua(B.AFrameworkApplication.X7f);
this.BWa=String.format("ParentFrameTokenStrategy uiHost={0} uiHostIntegrationType={1}",pa&&""!==pa?pa:"Unspecified",Ia&&""!==Ia?Ia:"Unspecified")}function v(pa,Ia,Ma,ob,Cb){this.scope=this.resource=null;this.silentLogin=!1;this.correlationId=this.options=null;this.resource=pa;this.scope=Ia;this.silentLogin=Ma;this.options=ob;this.correlationId=Cb}function m(){}function A(pa){this.Yng=pa}function x(){}b.r(D);y=b(0);var t=b(13),z=b(815),r=b(1056),G;(function(pa){pa[pa.external=0]="external";pa[pa.msa=
1]="msa";pa[pa.aad=2]="aad"})(G||(G={}));Object(y.b)("AuthorityType",G);Object(y.a)(x,"OAuthResult",null,[]);A.prototype.initialize=function(){return Promise.resolve(0)};A.prototype.Zhc=function(){return Promise.resolve(0)};A.prototype.YR=function(){t.ULS.sendTraceTag(574239257,3E3,50,"Automation flag set.  Returning Mock Token.");return Promise.resolve(Object.assign(new x,{IsSuccess:!0,Token:this.Yng}))};A.prototype.Jyc=function(){return Promise.resolve(Object.assign(new x,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",
ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};A.prototype.nxc=function(){return!1};A.prototype.Nub=function(){return"MockAuthTokenStrategy"};Object(y.a)(A,"MockAuthTokenStrategy",null,[630]);var w=b(1083);m.get=function(pa,Ia,Ma){if(!Ma)return pa;var ob=0;return Promise.race([pa,new Promise(function(Cb){ob=window.setTimeout(function(){Cb(Ia)},Ma)})]).then(function(Cb){window.clearTimeout(ob);return Promise.resolve(Cb)}).catch(function(){window.clearTimeout(ob);
return Promise.resolve(Ia)})};Object(y.a)(m,"PromiseWithTimeout",null,[]);var B=b(5),U=b(857);Object(y.a)(v,"TokenRequestParameters",null,[647]);var N=b(23),P=b(86);u.prototype.initialize=function(){var pa=this;return new Promise(function(Ia){P.a.instance.mc("Common.App.WopiIdentity.IWopiIdentity").execute(function(Ma){pa.ahe=Ma;Ia(0)})})};u.prototype.ii=function(pa){for(var Ia=!1,Ma=pa.toLocaleUpperCase(),ob=yl(["HTTPS:","API:"]),Cb=ob.next();!Cb.done;Cb=ob.next())if(Ma.startsWith(Cb.value)){Ia=
!0;break}return Ia||this.obi(pa)?pa+"/.default":pa};u.prototype.obi=function(pa){return RegExp("/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i").test(pa)};u.prototype.Zhc=function(){return Promise.resolve(0)};u.prototype.YR=function(pa,Ia,Ma,ob,Cb,Xa,Sb){if(N.a.qka){Cb=U.a.JOj;if(!Cb)return Ia=Object.assign(new x,{IsSuccess:!1,ErrorCode:"TeamsNoAllowListFound",ErrorMessage:"No app list was found."}),Promise.resolve(Ia);if(!Array.contains(Cb,pa))return Ia=Object.assign(new x,
{IsSuccess:!1,ErrorCode:"TeamsDisallowedApp",ErrorMessage:"Disallowed appName: "+pa}),Promise.resolve(Ia)}pa=this.ii(Ma);Ma=new v(Ma,pa,!ob,null,B.AFrameworkApplication.userSessionId);return this.ahe.getAccessToken(Ma,Ia,Sb).then(function(Tb){return Object.assign(new x,{IsSuccess:!0,Token:Tb.accessToken})},function(Tb){return Object.assign(new x,{IsSuccess:!1,ErrorCode:Tb})})};u.prototype.Jyc=function(){return Promise.resolve(Object.assign(new x,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",
ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};u.prototype.nxc=function(){return!1};u.prototype.Nub=function(){return this.BWa};Object(y.a)(u,"ParentFrameTokenStrategy",null,[630]);var ia=b(80),W=b(991),R=b(185);Object(y.a)(f,"PromiseWrapper",null,[]);l.prototype.enqueue=function(pa){var Ia=this;return new Promise(function(Ma,ob){Ia.vm.add(Object.assign(new f,{qGf:pa,resolve:Ma,reject:ob}));Ia.process()})};l.prototype.process=function(){var pa=
this;if(this.yjb||this.lB===this.vm.count)return!1;var Ia=this.vm.na(this.lB++);try{this.yjb=!0,Ia.qGf().then(function(Ma){pa.yjb=!1;pa.g0c(Ia,Ma,null,!0)}).catch(function(Ma){pa.yjb=!1;pa.g0c(Ia,null,Ma,!1)})}catch(Ma){this.yjb=!1,this.g0c(Ia,null,Ma,!1)}return!0};l.prototype.g0c=function(pa,Ia,Ma,ob){var Cb=this;ob?0<this._timeout?window.setTimeout(function(){pa.resolve(Ia);Cb.process()},this._timeout):(pa.resolve(Ia),Cb.process()):0<this._timeout?window.setTimeout(function(){pa.reject(Ma);Cb.process()},
this._timeout):(pa.reject(Ma),Cb.process())};Object(y.a)(l,"PromiseQueue",null,[]);Object(y.a)(n,"ResolveWithCorrelation",null,[]);var I=b(84),Q=b(140),O=b(962),ba=b(170),ca=Q.a;vm(k,ca);k.prototype.Dvc=function(){var pa={};pa=(pa.promptMessage=this.Fpg,pa.errorText=CommonUIStrings.l_InternalError,pa.rtl=B.AFrameworkApplication.isRtl,pa.frameLoaded=!1,pa.createFrame=Object(ia.a)(this,this.Q1g,"createFrame"),pa.resolveDialogStyles=this.p2d,pa);var Ia={};this.c1=(Ia.id="SharedAuthConsentDialog",Ia.bodyControls=
pa,Ia);this.kc=5;this.initializeAndShow(CommonUIStrings.l_SignIn,Object(ia.a)(this,this.Fnj,"sharedAuthConsentDialogHandler"),this.c1)};k.prototype.K$f=function(pa,Ia){var Ma=!0;Ma=void 0===Ma?!1:Ma;pa=void 0===pa?!1:pa;Ia=void 0===Ia?5:Ia;this.c1&&this.c1.bodyControls&&(Ma!==Object(I.a)(Object,this.c1.bodyControls).frameLoaded&&(Object(I.a)(Object,this.c1.bodyControls).frameLoaded=Ma),pa!==Object(I.a)(Object,this.c1.bodyControls).frameLoadSuccess&&(Object(I.a)(Object,this.c1.bodyControls).frameLoadSuccess=
pa),Ia!==this.c1.dialogButtonsOption&&(this.c1.dialogButtonsOption=null,this.kc=Ia),this.update(this.c1))};k.prototype.Ttj=function(pa,Ia){var Ma=new O.a(ba.a.Jnj),ob={};pa=(ob.signInLabel=CommonUIStrings.l_SignIn,ob.cancelLabel=CommonUIStrings.l_DialogCancel,ob.rtl=B.AFrameworkApplication.isRtl,ob.messageCorrelationId=pa,ob.dialogStyles=Ia,ob);Ma.Values=pa;this.pv.uQa(Ma,this.ls.contentWindow,this.NX)};k.prototype.WRe=function(){this.K$f(!1,6)};k.prototype.rKi=function(){this.WRe()};k.prototype.Q1g=
function(){return this.ls};k.prototype.Fnj=function(pa){pa||(this.vtg.reject(Object.assign(new x,{ErrorCode:"UserCancelled",ErrorMessage:"The interactive flow was cancelled by the user"})),this.hDa(null))};tl.Object.defineProperties(k.prototype,{YXf:{configurable:!0,enumerable:!0,get:function(){return this.ls}},jah:{configurable:!0,enumerable:!0,get:function(){var pa=this;return this.kjg.then(function(Ia){pa.q2d=!0;return Ia})}},kah:{configurable:!0,enumerable:!0,get:function(){return this.q2d}}});
Object(y.a)(k,"SharedAuthConsentDialog",Q.a,[646]);var S=b(1254),Y=b(93),na=b(47),Z=b(179),wa=b(178);c.prototype.Nub=function(){return this.BWa};c.prototype.initialize=function(){var pa=b(985).OAuthManager;if("loadFrame"in this.mqa)return this.mqa.loadFrame.Gqe;if(!this.NX)return Y.Health.instance.recordKpiFailure(pa.kpiName,"SharedAuthFrameOriginNotSet",!1,!1,null),t.ULS.sendTraceTag(562381581,3E3,10,"SharedAuthTokenStrategy Init failed: No Shared Frame Origin Path"),Promise.reject(1);pa=this.Wwc("loadFrame");
this.lRb=na.a.se();var Ia=this.NX+this.$de+"?replyUrl="+window.location.protocol+"//"+window.location.host+"&usid="+B.AFrameworkApplication.userSessionId+"&WacUserType="+B.AFrameworkApplication.userType;this.VVb&&(Ia+="&vnext=1");this.ls=document.createElement("iframe");this.h4h(this.ls);this.ls.style.cssText="height:0;width:0;display:none;";this.ls.id="SharedAuthFrame";this.ls.setAttribute("name","SharedAuthFrame");this.ls.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");
this.ls.setAttribute("title","SharedAuthFrame");this.ls.src=Ia;document.body.appendChild(this.ls);Ia=na.a.se()-this.lRb;t.ULS.sendTraceTag(573112899,3E3,50,"SharedAuthTokenStrategy Create: Frame Appended to Document. E/T:[{0}]. sharedAuthFrame.Src={1}",Ia,this.ls.src);return pa};c.prototype.Zhc=function(pa){this.gDc=pa;var Ia=new O.a(ba.a.aYf);Ia.Values=this.gqe(pa);pa=this.Wwc("initFrame");this.pv.uQa(Ia,this.ls.contentWindow,this.NX);t.ULS.sendTraceTag(573112900,3E3,50,"SharedAuthTokenStrategy Init: Called package initialize.");
return pa};c.prototype.YR=function(pa,Ia,Ma,ob,Cb,Xa){var Sb=this,Tb=new O.a(ba.a.Knj),da=this.ZZe();Tb.Values=this.t7f(pa,Ia,Ma,ob,Cb,Xa,da);pa=this.Wwc(da);ob&&B.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthInteractiveConsentUI",!1)?this.cmg.enqueue(function(){return new Promise(function(ya){Sb.wFj(Xa,Tb,ya,da)})}):(this.pv.uQa(Tb,this.ls.contentWindow,this.NX),t.ULS.sendTraceTag(573112901,3E3,50,"SharedAuthTokenStrategy TryGetToken: Called TryGetToken for app {0}",
Ia));return pa};c.prototype.wFj=function(pa,Ia,Ma,ob){var Cb=this.mqa[ob];Cb&&(this.OWa=Ia,this.hDa=Object.assign(new n,{resolve:Ma,correlationId:ob}),this.wL=new k(this.NX,this.$de,pa,this.pv,Cb,Ma,this.VVb),this.wL.Dvc())};c.prototype.ZZe=function(){return Z.a.create().toString()};c.prototype.t7f=function(pa,Ia,Ma,ob,Cb,Xa,Sb){var Tb={};Tb.appName=pa;Tb.appId=Ia;Tb.target=Ma;Tb.withPopup=ob;Tb.claims=Cb;Tb.promptMessage=Xa;Tb.messageCorrelationId=Sb;return Tb};c.prototype.h4h=function(pa){$addHandler(pa,
"load",Object(ia.a)(this,this.oFi,"onIFrameLoaded"));$addHandler(pa,"error",Object(ia.a)(this,this.Blc,"onIFrameError"));this.pv.TEa(this.NX);this.pv.Qn(ba.a.dYf);this.pv.Km(ba.a.dYf,Object(ia.a)(this,this.MJi,"onScriptLoaded"));this.pv.Qn(ba.a.cYf);this.pv.Km(ba.a.cYf,Object(ia.a)(this,this.LJi,"onScriptInitialized"));this.pv.Qn(ba.a.ZXf);this.pv.Km(ba.a.ZXf,Object(ia.a)(this,this.SEi,"onGetTokenResponse"));this.pv.Qn(ba.a.eYf);this.pv.Km(ba.a.eYf,Object(ia.a)(this,this.KGi,"onLoginResponse"));this.pv.Qn(ba.a.bYf);
this.pv.Km(ba.a.bYf,Object(ia.a)(this,this.KFi,"onInteractiveFlowReady"));this.pv.Qn(ba.a.$Xf);this.pv.Km(ba.a.$Xf,Object(ia.a)(this,this.hFi,"onHideDialog"));this.pv.Qn(ba.a.XXf);this.pv.Km(ba.a.XXf,Object(ia.a)(this,this.wAi,"onCloseDialog"))};c.prototype.Wwc=function(pa){var Ia=new f;Ia.startTime=na.a.se();var Ma=new Promise(function(ob,Cb){Ia.resolve=ob;Ia.reject=Cb});Ia.Gqe=Ma;this.mqa[pa]=Ia;return Ma};c.prototype.oFi=function(){var pa=na.a.se()-this.lRb;t.ULS.sendTraceTag(572346566,3E3,50,
"WACOAuth.aspx iFrame loaded successfully. E/T:[{0}]",pa)};c.prototype.Blc=function(pa){var Ia=b(985).OAuthManager,Ma=na.a.se()-this.lRb,ob=Object.assign(new wa.a,{durationMs:Ma});Y.Health.instance.recordKpiFailure(Ia.kpiName,"SharedAuthWACOAuthAspxFrameError",!1,!0,ob);t.ULS.sendTraceTag(572346567,3E3,10,"WACOAuth.aspx iFrame failed to load after {0} ms: {1}",Ma,this.a3d?JSON.stringify(pa):"")};c.prototype.MJi=function(pa){var Ia=b(985).OAuthManager,Ma=this.mqa.loadFrame,ob=na.a.se()-Ma.startTime,
Cb=pa.Values.AuthLibrary.toString();pa=pa.Values.Success.toString();t.ULS.sendTraceTag(573112902,3E3,50,"SharedAuthTokenStrategy OnScriptLoaded. Success={0} AuthLibrary={1} E/T: [{2}]",pa,Cb,ob);Cb&&(this.BWa="SharedAuthTokenStrategy "+Cb);Cb=Boolean.parse(pa);Cb||(pa=this.kq(),void 0!==pa&&null!==pa&&(pa.set("AuthLibrary",this.Nub()),ob=Object.assign(new wa.a,{durationMs:ob,extendedProperties:pa}),Y.Health.instance.recordKpiFailure(Ia.kpiName,"SharedAuthStrategyInitFailed",!1,!0,ob)));Ma.resolve(Cb?
0:1)};c.prototype.LJi=function(pa){var Ia=this;if(pa.Values.interactive&&this.OWa&&this.OWa.Values.messageCorrelationId){var Ma=this.OWa.Values.messageCorrelationId.toString();if(pa.Values.interactive&&this.wL){this.wL.jah.then(function(Cb){Ia.pv.uQa(Ia.OWa,Ia.wL.YXf.contentWindow,Ia.NX);Ia.wL.Ttj(Ma,Cb);Ia.wL.K$f(!0);Ia.OWa=null});return}}pa=this.mqa.initFrame;var ob=na.a.se()-pa.startTime;t.ULS.sendTraceTag(573112903,3E3,50,"SharedAuthTokenStrategy OnScriptInitialized. E/T: [{0}]",ob);pa.resolve(0)};
c.prototype.SEi=function(pa){if(pa.Values.messageCorrelationId&&pa.Values.messageCorrelationId.toString()){var Ia=pa.Values.messageCorrelationId.toString(),Ma=this.mqa[Ia];if(Ma){var ob=na.a.se()-Ma.startTime;t.ULS.sendTraceTag(573112906,3E3,50,"SharedAuthTokenStrategy OnGetTokenResponse. E/T: [{0}]",ob);pa.Values.isSuccess&&pa.Values.isSuccess?Ma.resolve(pa.Values.response):Ma.reject(pa.Values.response);this.I7f(Ia)}else t.ULS.sendTraceTag(573112905,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called with an unregistered messageCorrelationId")}else t.ULS.sendTraceTag(573112904,
3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called without valid messageCorrelationId")};c.prototype.KFi=function(){if(this.wL.kah)this.wL.WRe();else if(this.gDc&&this.wL){var pa=new O.a(ba.a.aYf);pa.Values=this.gqe(this.gDc,!0);this.pv.uQa(pa,this.wL.YXf.contentWindow,this.NX)}};c.prototype.hFi=function(){this.wL&&this.wL.Xvb()};c.prototype.wAi=function(pa){pa.Values.cancelled&&pa.Values.cancelled&&pa.Values.messageCorrelationId&&this.I7f(pa.Values.messageCorrelationId.toString());this.wL&&
this.wL.hide()};c.prototype.kq=function(){try{return new Map}catch(pa){return null}};c.prototype.gqe=function(pa,Ia){Ia=void 0===Ia?!1:Ia;var Ma={};Ma.appIds=this.SCh();Ma.upn=pa.loginHint;Ma.authority=pa.authority;Ma.authorityType=Object(z.a)(G,pa.authorityType);Ma.tenantId=pa.tenantId;Ma.correlationId=B.AFrameworkApplication.userSessionId;Ma.enableConsoleLogging=this.a3d;Ma.enablePopupFlash=this.Ejg;Ma.skipUpnCheck=this.Vrg;Ma.interactive=Ia;return Ma};c.prototype.SCh=function(){var pa=[],Ia=U.a.AUc,
Ma;for(Ma in Ia)Array.add(pa,Ia[Ma]);return pa};c.prototype.Jyc=function(pa,Ia,Ma,ob,Cb,Xa){var Sb=new O.a(ba.a.Inj),Tb=this.ZZe();Sb.Values=this.t7f(pa,Ia,Ma,ob,Cb,Xa,Tb);this.$fe=Sb;pa=this.Wwc(Tb);t.ULS.sendTraceTag(555049437,3E3,50,"SharedAuthTokenStrategy TryLogin: Called TryLogin for app {0}",Ia);this.wrj();return pa};c.prototype.nxc=function(){return!0};c.prototype.wrj=function(){var pa=this;this.Fib||(this.Fib=new W.a(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Title,CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Body,
null),this.Fib.id=16,this.Fib.Tbf=!1,this.Fib.addButton(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,function(){t.ULS.sendTraceTag(527827290,3E3,50,"SharedAuthTokenStrategy TryLogin: User Clicked Login");pa.pv.uQa(pa.$fe,pa.ls.contentWindow,pa.NX)},CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,!0),t.ULS.sendTraceTag(555049438,3E3,10,"Failed to add entry to business bar. Login message could not be shown to user."))};c.prototype.KGi=function(pa){if(pa.Values.messageCorrelationId&&pa.Values.messageCorrelationId.toString()){var Ia=
this.mqa[pa.Values.messageCorrelationId.toString()];if(Ia){var Ma=na.a.se()-Ia.startTime;t.ULS.sendTraceTag(555049441,3E3,50,"SharedAuthTokenStrategy OnLoginResponse. E/T: [{0}]",Ma);pa.Values.isSuccess&&pa.Values.isSuccess?Ia.resolve(pa.Values.response):Ia.reject(pa.Values.response)}else t.ULS.sendTraceTag(555049440,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called with an unregistered messageCorrelationId")}else t.ULS.sendTraceTag(555049439,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called without valid messageCorrelationId")};
c.prototype.I7f=function(pa){this.hDa&&this.hDa.correlationId===pa&&(this.hDa.resolve(null),this.hDa=null)};Object(y.a)(c,"SharedAuthTokenStrategy",null,[630]);d.prototype.initialize=function(){return Promise.resolve(0)};d.prototype.Zhc=function(){return Promise.resolve(0)};d.prototype.YR=function(){return Promise.resolve(Object.assign(new x,{IsSuccess:!1,ErrorCode:r.a[this.uNc],ErrorMessage:"Unable to get a token. Reason: ["+r.a[this.uNc]+"]"}))};d.prototype.Jyc=function(){return Promise.resolve(Object.assign(new x,
{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};d.prototype.nxc=function(){return!1};d.prototype.Nub=function(){return this.BWa};Object(y.a)(d,"UnsupportedAuthTokenStrategy",null,[630]);var ma=b(846);b.d(D,"OAuthManager",function(){return a});a.prototype.x$g=function(){var pa=U.a.kti;pa&&0<pa.length?(this.iS=1,this.vO=new A(pa)):B.AFrameworkApplication.ga.ra("IsO365ConsumerHost")||B.AFrameworkApplication.ga.ra("IsO365CommercialHost")?
B.AFrameworkApplication.ga.ra("IsAnonymousUser")?(this.iS=2,this.vO=new d(this.iS)):(pa=w.a.getAuthContext().loginHint)&&pa.length?U.a.$vb?(this.iS=1,this.vO=new u):(this.iS=1,this.vO=new c):(this.iS=3,this.vO=new d(this.iS)):(this.iS=4,this.vO=new d(this.iS))};a.prototype.Cu=function(){return this.vO?this.vO.Nub()||"Unknown":"None"};a.prototype.w$g=function(pa){var Ia=this;pa=void 0===pa?null:pa;t.ULS.sendTraceTag(562128578,3E3,50,"Creating OAuthManager.");var Ma=na.a.se();return B.AFrameworkApplication.ga.Lcd().then(function(ob){ob?
(Ia.x$g(),pa&&(Ia.vO=pa),t.ULS.sendTraceTag(42084323,3E3,50,"Creation succeeded OAuthManager successfully in {4} ms with clientVer={0}, appVer={1}, docVer={2}, strategy={3}",U.a.clientVersion,U.a.appVersion,U.a.Dch,Ia.Cu(),Math.floor(na.a.se()-Ma))):t.ULS.sendTraceTag(562128579,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(na.a.se()-Ma));return Promise.resolve(ob)},function(){t.ULS.sendTraceTag(562128580,3E3,
15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(na.a.se()-Ma));return Promise.resolve(!1)})};a.prototype.D2h=function(){var pa=this;t.ULS.sendTraceTag(573390991,3E3,50,"Initializing {0}",this.Cu());var Ia=na.a.se();return m.get(this.vO.initialize(),2,U.a.hDd).then(function(Ma){if(Ma)if(1===Ma){t.ULS.sendTraceTag(527827291,3E3,15,"Initialization failed for {0} in {1} ms, all future TryGetToken requests will fail.",
pa.Cu(),Math.floor(na.a.se()-Ia));var ob=pa.kq();void 0!==ob&&null!==ob&&(ob.set("AuthLibrary",pa.Cu()),ob=Object.assign(new wa.a,{durationMs:Math.floor(na.a.se()-Ia),extendedProperties:ob}),Y.Health.instance.recordKpiFailure(a.kpiName,"StrategyInitFailed",!1,!0,ob))}else 2===Ma&&(t.ULS.sendTraceTag(42267908,3E3,15,"Initialization timed out for {0} after {1} ms, all future TryGetToken requests will fail.",pa.Cu(),Math.floor(na.a.se()-Ia)),ob=pa.kq(),void 0!==ob&&null!==ob&&(ob.set("AuthLibrary",pa.Cu()),
ob=Object.assign(new wa.a,{durationMs:Math.floor(na.a.se()-Ia),extendedProperties:ob}),Y.Health.instance.recordKpiFailure(a.kpiName,"StrategyInitTimedOut",!1,!0,ob)));else t.ULS.sendTraceTag(42084353,3E3,50,"Initialization succeeded for {0} in {1} ms.",pa.Cu(),Math.floor(na.a.se()-Ia));return Promise.resolve(Ma)},function(){t.ULS.sendTraceTag(574239256,3E3,15,"Initialization failed for {0} after {1} ms, all future TryGetToken requests will fail.",pa.Cu(),Math.floor(na.a.se()-Ia));return Promise.resolve(1)})};
a.prototype.Vki=function(){var pa=this;t.ULS.sendTraceTag(562128581,3E3,50,"Loading {0}",this.Cu());var Ia=na.a.se();return m.get(this.vO.Zhc(w.a.getAuthContext()),2,U.a.hDd).then(function(Ma){if(Ma)if(1===Ma){t.ULS.sendTraceTag(562128583,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",pa.Cu(),Math.floor(na.a.se()-Ia));var ob=pa.kq();void 0!==ob&&null!==ob&&(ob.set("AuthLibrary",pa.Cu()),ob=Object.assign(new wa.a,{durationMs:Math.floor(na.a.se()-Ia),extendedProperties:ob}),
Y.Health.instance.recordKpiFailure(a.kpiName,"StrategyLoadFailed",!1,!0,ob))}else 2===Ma&&(t.ULS.sendTraceTag(558469660,3E3,15,"Load timed out for {0} after {1} ms, all future TryGetToken requests will fail.",pa.Cu(),Math.floor(na.a.se()-Ia)),ob=pa.kq(),void 0!==ob&&null!==ob&&(ob.set("AuthLibrary",pa.Cu()),ob=Object.assign(new wa.a,{durationMs:Math.floor(na.a.se()-Ia),extendedProperties:ob}),Y.Health.instance.recordKpiFailure(a.kpiName,"StrategyLoadTimedOut",!1,!0,ob)));else t.ULS.sendTraceTag(562128582,
3E3,50,"Load succeeded for {0} in {1} ms.",pa.Cu(),Math.floor(na.a.se()-Ia));return Promise.resolve(Ma)},function(){t.ULS.sendTraceTag(562128584,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",pa.Cu(),Math.floor(na.a.se()-Ia));return Promise.resolve(1)})};a.prototype.YR=function(pa,Ia,Ma){return this.Hyc(pa,Ia,!1,null,"",void 0===Ma?null:Ma)};a.prototype.u7f=function(pa,Ia,Ma,ob,Cb){return this.Hyc(pa,Ia,!0,Ma,ob,void 0===Cb?null:Cb)};a.prototype.Hyc=function(pa,
Ia,Ma,ob,Cb,Xa,Sb){Sb=void 0===Sb?0:Sb;Sb+=1;t.ULS.sendTraceTag(42084352,3E3,50,"OAuthManager TryGetToken(appName={0}, target={1}) called.  Using strategy {2} - attempt {3}",pa,this.fQa(pa,Ia),this.Cu(),Sb);var Tb=this.kq();void 0!==Tb&&null!==Tb&&(Tb.set("AuthLibrary",this.Cu()),Tb.set("AppName",pa),Tb.set("Target",this.fQa(pa,Ia)),Y.Health.instance.recordKpiUsage(a.kpiName,0,"WacOAuthFC",Tb));if(!U.a.isEnabled){var da;return this.Trd((da=new x,da.IsSuccess=!1,da.Token=null,da.ErrorCode="NotEnabled",
da.ErrorMessage="OAuthManager is disabled.",da),pa)}var ya=U.a.AUc[pa];if(void 0===ya||null===ya){t.ULS.sendTraceTag(41961345,3E3,15,"Auth context not found. Ensure that your app [{0}] is listed in the OAuthManagerApplications setting.",pa);var hb;return this.Trd((hb=new x,hb.IsSuccess=!1,hb.Token=null,hb.ErrorCode="DisallowedApp",hb.ErrorMessage="Disallowed appName: "+pa,hb),pa)}var Gb=na.a.se(),Qb=this;Tb=this.Slg.then(function(sa){return Qb.h8h(pa,ya,Ia,Ma,ob,Cb,Xa,sa)});da=Ma?0:U.a.hDd;var Fb;
hb=(Fb=new x,Fb.IsSuccess=!1,Fb.Token=null,Fb.ErrorCode="authTokenStrategy_timeout",Fb.ErrorMessage="Auth Strategy timed out after ["+da+"] ms when fetching token",Fb);var ta=this,xa=this;return m.get(Tb,hb,da).then(function(sa){return Sb<=a.Fri&&(sa.ErrorCode===a.D5f||sa.ErrorCode===a.vyj)?(t.ULS.sendTraceTag(573175516,3E3,50,"TryGetToken attempt {0} timed out after {1} ms - retrying",Sb,Math.floor(na.a.se()-Gb)),ta.Hyc(pa,Ia,Ma,ob,Cb,Xa,Sb)):sa.ErrorCode===a.lff&&!Ma&&(t.ULS.sendTraceTag(561517645,
3E3,50,"TryGetToken attempt {0} failed with ITP error.  3P Cookies are [{1}]. Retry: [{2]}]",Sb,a.jIe),a.cgh&&ta.vO.nxc()&&ta.vO.Jyc(pa,ya,Ia,Ma,ob,Cb).then(function(lb){return Promise.resolve(ta.sic(lb,pa,Ia,ya,Gb))}).catch(function(){var lb,Yb=(lb=new x,lb.IsSuccess=!1,lb.Token=null,lb.ErrorCode="authTokenStrategy_failure",lb.ErrorMessage="LoginPopup failed, GetToken could not be called",lb);return Promise.resolve(ta.sic(Yb,pa,Ia,ya,Gb))}),a.jIe)?ta.Hyc(pa,Ia,!0,ob,Cb,Xa,Sb):Promise.resolve(ta.sic(sa,
pa,Ia,ya,Gb))}).catch(function(){var sa,lb=(sa=new x,sa.IsSuccess=!1,sa.Token=null,sa.ErrorCode="authTokenStrategy_failure",sa.ErrorMessage="Auth Strategy failed with an unknown error",sa);return Promise.resolve(xa.sic(lb,pa,Ia,ya,Gb))})};a.prototype.h8h=function(pa,Ia,Ma,ob,Cb,Xa,Sb,Tb){var da=this;return 1===Tb||2===Tb?this.Trd(Object.assign(new x,{IsSuccess:!1,Token:null,ErrorCode:1===Tb?"InitFailed":"InitTimedOut",ErrorMessage:"Auth Strategy Failed to Init or Load"}),pa):this.vO.YR(pa,Ia,Ma,ob,
Cb,Xa,Sb).then(function(ya){return Promise.resolve(da.Bof(ya,!0,pa))}).catch(function(ya){return Promise.resolve(da.Bof(ya,!1,pa))})};a.prototype.sic=function(pa,Ia,Ma,ob,Cb){var Xa={};Cb=na.a.se()-Cb;Xa.IsSuccess=pa.IsSuccess;Xa.ErrorCode=pa.IsSuccess?"Success":pa.ErrorCode||"";Xa.ErrorMessage=pa.IsSuccess?"Success":this.fQa(Ia,pa.ErrorMessage||"");Xa.Target=this.fQa(Ia,Ma||"");Xa.TimeInMS=Math.floor(Cb);Xa.AuthLibrary=this.Cu();Xa.AppName=Ia;Xa.AuthorityType=Object(z.a)(G,w.a.s9b());Xa.UserType=
this.hUh(w.a.getAuthContext());Xa.IsAuthSupportedInSession=r.a[this.iS];Xa.RequestCount=++this.lqg;Xa.AppId=ob;t.ULS.sendTraceTag(593863640,3E3,50,JSON.stringify(Xa));pa.IsSuccess||(Ma=this.kq(),void 0!==Ma&&null!==Ma&&(Ma.set("AppName",Ia),Ma.set("AuthLibrary",this.Cu()),Ma.set("ErrorCode",pa.ErrorCode),Ma.set("ErrorMessage",this.fQa(Ia,pa.ErrorMessage)),Ia=Object.assign(new wa.a,{durationMs:Cb,extendedProperties:Ma}),Y.Health.instance.recordKpiFailure(a.kpiName,"TryGetTokenFailure",!1,!0,Ia)));
return pa};a.prototype.Trd=function(pa,Ia){t.ULS.sendTraceTag(578435090,3E3,15,"OAuthManager failed without invoking GetToken. AppName: '{0}', Reason: '{1}'",Ia,this.fQa(Ia,pa.ErrorMessage));var Ma=this.kq();void 0!==Ma&&null!==Ma&&(Ma.set("AppName",Ia),Ma.set("AuthLibrary",this.Cu()),Ma.set("ErrorCode",pa.ErrorCode),Ma.set("ErrorMessage",this.fQa(Ia,pa.ErrorMessage)),Ia=Object.assign(new wa.a,{extendedProperties:Ma}),Y.Health.instance.recordKpiFailure(a.kpiName,"FailureBeforeGetToken",!1,!0,Ia));
return Promise.resolve(pa)};a.prototype.Caf=function(pa){return pa===ma.a.Xxc};a.prototype.fQa=function(pa,Ia){return this.Caf(pa)&&Ia?"REDACTED":Ia};a.prototype.hUh=function(pa){return B.AFrameworkApplication.ga.ra("IsAnonymousUser")?"anonymous":!pa.loginHint||1>pa.loginHint.length?"empty":-1<pa.loginHint.indexOf("guest#")?"guest":-1<pa.loginHint.indexOf("ext#")?"external":0>pa.upn.indexOf("@")?"no-at":"supported"};a.prototype.gLa=function(){return 1===this.iS};a.prototype.Bof=function(pa,Ia,Ma){var ob=
null,Cb=null,Xa=null,Sb=null;pa?pa.ErrorCode||pa.ErrorMessage?(Cb=pa.ErrorCode?pa.ErrorCode:a.fOe,Xa=pa.ErrorMessage?pa.ErrorMessage:"No message"):pa.Token?Ia?ob=pa.Token:(Cb=a.Y1i,Xa="A rejected promise returned a token."):(Cb=a.fOe,Xa=JSON.stringify(pa)):(Cb=a.Hvi,Xa="No result came from Auth Token Strategy");pa&&pa.Telemetry&&!this.Caf(Ma)&&(Sb=pa.Telemetry,t.ULS.sendTraceTag(579166408,3E3,50,JSON.stringify(Sb)));if(Cb===a.wti||Cb===a.YCj)Cb=a.D5f,Xa="Auth Library Timed Out";Cb===a.lIg&&-1<Xa.indexOf(a.lug)&&
(Cb=a.lff);if(Cb||Xa)ob=null;return Object.assign(new x,{IsSuccess:!!ob,Token:ob,ErrorCode:Cb,ErrorMessage:Xa,Telemetry:Sb})};a.prototype.kq=function(){try{return new Map}catch(pa){return null}};tl.Object.defineProperties(a,{jIe:{configurable:!0,enumerable:!0,get:function(){return B.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthInteractiveFallbackEnabled",!1)}},cgh:{configurable:!0,enumerable:!0,get:function(){return B.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthLoginFlowEnabled",
!1)}}});a.YCj="token_renewal_error";a.fOe="Exception";a.Hvi="NoResult";a.Y1i="RejectToken";a.wti="monitor_window_timeout";a.D5f="Timeout";a.vyj="authTokenStrategy_timeout";a.lIg="login_required";a.lug="AADSTS50058";a.lff="Cookies Disabled";a.kpiName="OAuthManager";a.Fri=2;Object(y.a)(a,"OAuthManager",null,[574])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDS.oauth.js.map/bb0f1b99b00f03ac48a3a215f1491a51/EwaDS.oauth.js.map